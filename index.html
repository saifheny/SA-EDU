<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>SA Educational Institution | منصة التعليم الذكي</title>
    <meta name="description" content="منصة SA EDU التعليمية الرائدة، النظام المتكامل لإدارة التعلم والاختبارات الإلكترونية المدعوم بالذكاء الاصطناعي. منصة شاملة للطلاب والمعلمين، اختبارات تفاعلية، تصحيح تلقائي، مساعد دراسي ذكي، وشبكة تواصل تعليمية. تغطية شاملة للمناهج الدراسية للمراحل الابتدائية، الإعدادية، والثانوية.">
    <meta name="keywords" content="تعليم, منصة تعليمية, اختبارات اونلاين, ذكاء اصطناعي في التعليم, SA EDU, SA Educational, نظام إدارة التعلم, LMS, امتحانات الكترونية, تصحيح تلقائي, بنك أسئلة, الثانوية العامة, المناهج المصرية, المناهج السعودية, تعليم الكتروني, مراجعات نهائية, فيزياء, كيمياء, رياضيات, أحياء, لغة عربية, لغة انجليزية, الصف الأول الثانوي, الصف الثاني الثانوي, الصف الثالث الثانوي, المرحلة الإعدادية, المرحلة الابتدائية, مساعد ذكي, حل واجبات, مدرس خصوصي, منصة ريس, دردشة تعليمية, تطبيق تعليمي, تعليم عن بعد, فصول افتراضية, نتائج الطلاب, متابعة ولي الأمر, الذكاء الاصطناعي, AI Education, EdTech, E-learning Platform, Online Exams">
    <meta name="author" content="SA Educational Institution">
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
    <meta property="og:locale" content="ar_AR">
    <meta property="og:type" content="website">
    <meta property="og:title" content="SA Educational Institution | مستقبل التعليم بين يديك">
    <meta property="og:description" content="انضم إلى أقوى منصة تعليمية مدعومة بالذكاء الاصطناعي. اختبارات، مراجعات، ومجتمع طلابي متكامل.">
    <meta property="og:url" content="https://sa-edu.com">
    <meta property="og:site_name" content="SA EDU">
    <meta property="og:image" content="https://i.postimg.cc/BQQb5YDn/MOWU-DESIGN.png">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="SA Educational Institution | التعليم الذكي">
    <meta name="twitter:description" content="منصة تعليمية متكاملة للطلاب والمعلمين. ذكاء اصطناعي، اختبارات، وتواصل فعال.">
    <meta name="twitter:image" content="https://i.postimg.cc/BQQb5YDn/MOWU-DESIGN.png">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="manifest.json">
    <link rel="canonical" href="https://sa-edu.com">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&family=Outfit:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <script src='https://unpkg.com/tesseract.js@v2.1.0/dist/tesseract.min.js'></script>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "EducationalOrganization",
      "name": "SA Educational Institution",
      "url": "https://sa-edu.com",
      "logo": "https://i.postimg.cc/BQQb5YDn/MOWU-DESIGN.png",
      "sameAs": [
        "https://facebook.com/sa-edu",
        "https://twitter.com/sa-edu",
        "https://instagram.com/sa-edu"
      ],
      "description": "منصة تعليمية متطورة تقدم خدمات الاختبارات الإلكترونية والتعليم المدعوم بالذكاء الاصطناعي للطلاب والمعلمين.",
      "knowsAbout": ["Education", "Artificial Intelligence", "E-Learning", "Exams", "Curriculum"]
    }
    </script>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "SA EDU App",
      "applicationCategory": "EducationalApplication",
      "operatingSystem": "All",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "EGP"
      }
    }
    </script>
</head>
<body>
    <audio id="snd-click" src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3" preload="auto"></audio>
    <audio id="snd-sent" src="https://assets.mixkit.co/active_storage/sfx/2354/2354-preview.mp3" preload="auto"></audio>
    <audio id="snd-recv" src="https://assets.mixkit.co/active_storage/sfx/2358/2358-preview.mp3" preload="auto"></audio>
    <audio id="snd-success" src="https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.mp3" preload="auto"></audio>
    <audio id="snd-like" src="https://assets.mixkit.co/active_storage/sfx/2580/2580-preview.mp3" preload="auto"></audio>

    <div id="construction-overlay">
        <div class="construction-loader"></div>
        <div class="construction-text">SA AI Building...</div>
        <div class="construction-sub">جاري بناء وتجهيز البيانات</div>
    </div>

    <div id="landing-layer">
        <div class="landing-wrap">
            <h1 style="font-size: 3.5rem; background: linear-gradient(to right, #fff, #3b82f6); -webkit-background-clip: text; color: transparent; margin: 0; text-shadow: 0 0 30px rgba(59, 130, 246, 0.5);">SA EDU</h1>
            <div style="min-height: 40px; margin-top: 10px; display:flex; justify-content:center; align-items:center; gap:5px;">
                <span id="landing-type-text" class="landing-text"></span><span class="typewriter-cursor"></span>
            </div>
            <div style="margin-top: 30px;">
                <img src="https://i.postimg.cc/BQQb5YDn/MOWU-DESIGN.png" class="landing-avatar-img" alt="Logo">
            </div>
            <button onclick="goToAuth()" class="modern-btn" style="margin-top: 50px; font-size: 1.1rem; background: #ffffff; color: #000000; border: none; box-shadow: 0 0 30px rgba(255, 255, 255, 0.2); font-weight: 800; font-family: 'Outfit', sans-serif;">
                ENTER THE REALM <i class="fas fa-dungeon" style="margin-left: 8px;"></i>
            </button>
        </div>
    </div>

    <div id="auth-layer" class="hidden">
        <div class="flex-center" style="height: 100%; flex-direction: column; padding: 30px;">
            <div onclick="backToLanding()" style="position: absolute; top: 40px; right: 30px; cursor: pointer; padding: 10px;"><i class="fas fa-arrow-right fa-xl"></i></div>
            <h2 style="margin: 0 0 30px;">بوابة الدخول</h2>
            <div class="role-toggle-container">
                <button class="role-toggle-btn active" id="btn-role-student" onclick="setAuthRole('student')">طالب</button>
                <button class="role-toggle-btn" id="btn-role-teacher" onclick="setAuthRole('teacher')">معلم</button>
            </div>
            <div id="auth-avatar-display" class="avatar-frame avatar-student" style="margin-bottom: 30px;">
                <i class="fas fa-user-astronaut"></i>
            </div>
            <div class="names-row">
                <input type="text" id="auth-name-1" class="smart-input" placeholder="الاسم الأول" style="text-align: center;">
                <input type="text" id="auth-name-2" class="smart-input" placeholder="الاسم الثاني" style="text-align: center;">
            </div>
            <input type="text" id="auth-name-3" class="smart-input" placeholder="الاسم الثالث" style="text-align: center;">
            <input type="password" id="auth-pass" class="smart-input" placeholder="الرمز السري (6 خانات)" maxlength="6" style="text-align: center;">
            <button onclick="handleSmartAuth()" class="modern-btn" style="margin-top: 50px;">
                تسجيل الدخول <i class="fas fa-sign-in-alt"></i>
            </button>
            <div id="auth-status" style="margin-top: 20px; color: var(--warning); font-size: 0.9rem;"></div>
        </div>
    </div>

    <div id="ai-history-sidebar" class="ai-history-sidebar">
        <div class="history-header">
            <span style="font-weight:bold; color:#fff;">سجل المحادثات</span>
            <i class="fas fa-times" onclick="toggleHistory(false)" style="cursor:pointer; color:#888;"></i>
        </div>
        <div class="history-list" id="ai-history-list"></div>
    </div>

    <div id="teacher-app" class="hidden">
        <nav class="top-nav">
            <div class="nav-container">
                <button class="nav-btn active" onclick="switchTab('t-library', this)"><i class="fas fa-layer-group"></i><span>المكتبة</span></button>
                <button class="nav-btn" onclick="switchTab('t-reese', this)"><i class="fas fa-feather-alt"></i><span>ريس</span></button>
                <button class="nav-btn" onclick="switchTab('t-dardasha', this)"><i class="fab fa-telegram-plane"></i><span>دردشة</span></button>
                <button class="nav-btn magic-btn" onclick="switchTab('t-ai', this)"><i class="fas fa-wand-magic-sparkles"></i><span>AI</span></button>
                <button class="nav-btn" onclick="toggleMenu()"><i class="fas fa-bars"></i><span>القائمة</span></button>
            </div>
        </nav>
        <div class="portal-container">
            <section id="t-library" class="app-section">
                <div class="mobile-spacer"></div>
                <div class="create-exam-cta" onclick="switchTab('t-create')">
                    <i class="fas fa-file-signature cta-bg-icon"></i>
                    <div class="cta-content">
                        <div class="cta-icon-wrapper"><i class="fas fa-plus"></i></div>
                        <div style="text-align: right; flex: 1;">
                            <div style="display:flex; align-items:center; gap:3px;">
                                <h3 id="cta-type-text" class="typewriter-text"></h3><span class="typewriter-cursor"></span>
                            </div>
                            <p style="margin: 4px 0 0; color: #ccc; font-size: 0.85rem;">انقر للبدء في إنشاء اختبار جديد للطلاب</p>
                        </div>
                    </div>
                    <div style="color: #666; position:relative; z-index:2;"><i class="fas fa-chevron-left"></i></div>
                </div>
                <div class="search-wrap">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" class="google-bar" id="t-search" placeholder="ابحث في اختباراتك...">
                </div>
                <div id="t-tests-list"></div>
            </section>

            <section id="t-reese" class="app-section hidden full-width-section">
                <div class="mobile-spacer"></div>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding: 0 15px;">
                    <h2 style="margin:0; font-family:'Outfit', sans-serif;">Reese SA</h2>
                    <button class="icon-btn-small" style="background:rgba(255,255,255,0.05); width:40px; height:40px;" onclick="toggleMyPostsView()">
                        <i class="fas fa-eraser" id="t-eraser-icon" style="color:#aaa;"></i>
                    </button>
                </div>
                <div class="reese-input-trigger" onclick="openReeseCompose()">
                    <div class="reese-avatar-mini" id="reese-trigger-avatar-t"></div>
                    <div class="reese-placeholder">ماذا يدور في ذهنك اليوم؟</div>
                    <div style="display:flex; gap:6px; align-items:center;">
                        <i class="fas fa-image" style="color:#555; font-size:1rem;"></i>
                        <i class="fas fa-paper-plane" style="color:var(--accent-primary); font-size:1rem;"></i>
                    </div>
                </div>
                <div id="reese-feed-container-t" class="feed-container"></div>
            </section>

            <section id="t-dardasha" class="app-section hidden" style="padding: 0; max-width: 100%;">
                <div class="chat-layout">
                    <div class="chat-sidebar" id="t-chat-sidebar">
                        <div class="chat-sidebar-header">
                            <div class="my-chat-info" onclick="openMyProfileModal()">
                                <div class="avatar-frame mini-frame" id="t-chat-my-avatar"></div>
                                <span>دردشة</span>
                            </div>
                            <button class="icon-btn-small" onclick="toggleUserSearchModal()"><i class="fas fa-plus"></i></button>
                        </div>
                        <div class="chat-search-bar">
                            <i class="fas fa-search"></i>
                            <input type="text" placeholder="بحث في المحادثات..." onkeyup="filterChats('t', this.value)">
                        </div>
                        <div class="chat-list" id="t-chat-list"></div>
                    </div>
                    <div class="chat-window hidden" id="t-chat-window">
                    </div>
                </div>
            </section>

            <section id="t-results" class="app-section hidden">
                <div class="mobile-spacer"></div>
                <div class="back-btn-header" onclick="switchTab('t-library')"><i class="fas fa-arrow-right"></i> الرئيسية</div>
                <h2>نتائج الطلاب</h2>
                <select id="t-result-select" class="smart-input" style="text-align: right;"><option>اختر الاختبار للعرض</option></select>
                <div id="t-results-container"></div>
            </section>

            <section id="t-create" class="app-section hidden">
                <div class="mobile-spacer"></div>
                <div class="back-btn-header" onclick="resetCreateForm(); switchTab('t-library');"><i class="fas fa-arrow-right"></i> إلغاء</div>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="margin: 0;" id="create-page-title">اختبار جديد</h2>
                    <button onclick="toggleAiGenerator()" style="background: rgba(217, 70, 239, 0.1); border: 1px solid #d946ef; color: #d946ef; padding: 6px 15px; border-radius: 20px; font-size: 0.8rem; display: flex; align-items: center; gap: 5px; font-weight: bold;">
                        <i class="fas fa-wand-magic-sparkles"></i> توليد بالـ AI
                    </button>
                </div>
                <input type="text" id="new-test-name" class="smart-input" placeholder="عنوان الاختبار (مثال: فيزياء - الوحدة الأولى)" style="font-weight: bold;">
                <div style="display: flex; gap: 10px;">
                    <select id="new-test-grade" class="smart-input" onchange="checkCustomGrade(this)">
                        <option value="" disabled selected>الصف الدراسي</option>
                        <option value="1p">الأول الابتدائي</option>
                        <option value="2p">الثاني الابتدائي</option>
                        <option value="3p">الثالث الابتدائي</option>
                        <option value="4p">الرابع الابتدائي</option>
                        <option value="5p">الخامس الابتدائي</option>
                        <option value="6p">السادس الابتدائي</option>
                        <option value="1m">الأول الإعدادي</option>
                        <option value="2m">الثاني الإعدادي</option>
                        <option value="3m">الثالث الإعدادي</option>
                        <option value="1s">الأول الثانوي</option>
                        <option value="2s">الثاني الثانوي</option>
                        <option value="3s">الثالث الثانوي</option>
                        <option value="custom" style="color: var(--accent-gold);">-- كتابة صف مخصص --</option>
                    </select>
                    <input type="number" id="new-test-duration" class="smart-input" placeholder="المدة (د)" style="width: 100px; text-align: center;">
                </div>
                <input type="text" id="custom-grade-input" class="smart-input hidden" placeholder="اكتب اسم الصف هنا..." style="border-color: var(--accent-gold);">
                <div id="q-editor-box" style="background: #151515; padding: 20px; border-radius: 20px; border: 1px solid #333; margin-top: 20px;">
                    <h3 style="font-size: 1rem; color: #888; margin-top: 0; margin-bottom: 15px;">إضافة سؤال</h3>
                    
                    <div class="type-toggle-container">
                        <label class="type-radio-label active" onclick="setQType('mcq', this)">
                            <i class="fas fa-list-ul"></i> اختياري
                            <input type="radio" name="q-type" value="mcq" class="type-radio-input" checked>
                        </label>
                        <label class="type-radio-label" onclick="setQType('essay', this)">
                            <i class="fas fa-align-right"></i> مقالي
                            <input type="radio" name="q-type" value="essay" class="type-radio-input">
                        </label>
                    </div>

                    <textarea id="q-text" class="smart-input" rows="2" placeholder="اكتب نص السؤال"></textarea>
                    
                    <div id="mcq-section-wrapper">
                        <div id="mcq-options-container"></div>
                        <button onclick="addOptionField()" class="modern-btn secondary" style="width: auto; padding: 8px 15px; font-size: 0.8rem; margin-bottom: 15px;">
                            <i class="fas fa-plus"></i> إضافة خيار آخر
                        </button>
                    </div>

                    <div style="display: flex; gap: 10px; margin-top: 10px; border-top: 1px solid #333; padding-top: 15px;">
                        <input type="number" id="q-points" value="1" class="smart-input" style="width: 80px; text-align: center; margin:0;" placeholder="درجة">
                        <label class="smart-input" style="flex: 1; text-align: center; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; border: 1px dashed #444; margin:0;">
                            <i class="fas fa-image"></i> <span id="q-img-label">إرفاق صورة</span>
                            <input type="file" id="q-image-input" hidden accept="image/*">
                        </label>
                    </div>
                    <div id="q-img-preview" class="hidden" style="margin-top: 10px; text-align: center;"><img src="" style="height: 80px; border-radius: 10px;"></div>
                    <button id="btn-add-q" onclick="addQuestionToList()" class="modern-btn" style="margin-top: 15px; background: #333; color: #fff;">
                        <i class="fas fa-check"></i> إضافة السؤال
                    </button>
                </div>
                <h3 style="margin-top: 30px; margin-bottom: 10px;">الأسئلة المضافة:</h3>
                <div id="added-questions-list" style="margin-bottom: 30px;"></div>
                <button id="btn-save-test" class="modern-btn" onclick="saveTest()" style="background: var(--success); color: white; margin-bottom: 50px;">
                    <i class="fas fa-save"></i> نشر الاختبار النهائي
                </button>
            </section>

            <section id="t-ai" class="app-section hidden">
                <div class="ai-layout">
                    <div class="ai-top-bar">
                        <div style="display:flex; gap:10px;">
                            <button class="ai-action-btn new-chat" onclick="startNewChat('t')" title="محادثة جديدة"><i class="fas fa-plus"></i></button>
                            <button class="ai-action-btn history" onclick="toggleHistory(true)" title="السجل"><i class="fas fa-history"></i></button>
                            <button class="ai-action-btn incognito" id="t-incognito-btn" onclick="toggleIncognito('t')" title="محادثة مخفية"><i class="fas fa-user-secret"></i></button>
                        </div>
                        <div style="display:flex; gap:10px;">
                            <button class="ai-action-btn" onclick="shareCurrentChat()" title="مشاركة المحادثة"><i class="fas fa-share-nodes"></i></button>
                        </div>
                    </div>
                    <div class="ai-messages" id="t-ai-msgs"></div>
                    
                    <div class="gemini-input-wrapper">
                        <div class="gemini-input-container">
                            <label for="t-ai-file" class="gemini-img-btn" title="إرفاق صورة"><i class="fas fa-camera"></i></label>
                            <input type="file" id="t-ai-file" hidden accept="image/*" onchange="previewChatImg('t')">
                            
                            <input type="text" id="t-ai-input" class="gemini-text-input" placeholder="اكتب، تخيل، أنشئ..." oninput="toggleAiSendMic('t', this.value)">
                            
                            <button id="t-mic-btn" class="gemini-mic-btn" onclick="startVoiceInput('t')" title="إدخال صوتي"><i class="fas fa-microphone"></i></button>
                            <button id="t-send-btn" onclick="sendAiMsg('t')" class="gemini-send-btn" style="display:none"><i class="fas fa-paper-plane"></i></button>
                        </div>
                        <div id="t-chat-preview" class="chat-img-preview">
                            <i class="fas fa-times" onclick="clearChatImg('t')"></i>
                            <img src="" id="t-chat-img-tag">
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <div id="student-app" class="hidden">
        <nav class="top-nav">
            <div class="nav-container">
                <button class="nav-btn active" onclick="switchTab('s-exams', this)"><i class="fas fa-book-open"></i><span>اختبارات</span></button>
                <button class="nav-btn" onclick="switchTab('s-reese', this)"><i class="fas fa-feather-alt"></i><span>ريس</span></button>
                <button class="nav-btn" onclick="switchTab('s-dardasha', this)"><i class="fab fa-telegram-plane"></i><span>دردشة</span></button>
                <button class="nav-btn magic-btn" onclick="switchTab('s-ai', this)"><i class="fas fa-wand-magic-sparkles"></i><span>AI</span></button>
                <button class="nav-btn" onclick="toggleMenu()"><i class="fas fa-bars"></i><span>القائمة</span></button>
            </div>
        </nav>
        <div class="portal-container">
            <section id="s-exams" class="app-section">
                <div class="mobile-spacer"></div>
                <div class="search-wrap">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" class="google-bar" id="s-search" placeholder="ابحث عن اختبار...">
                </div>
                <div class="create-exam-cta" style="margin-bottom: 20px; cursor: default; background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(16, 185, 129, 0.05)); border-color: rgba(255,255,255,0.1);">
                    <i class="fas fa-brain cta-bg-icon"></i>
                    <div class="cta-content">
                        <div class="cta-icon-wrapper" style="background: var(--accent-gold); box-shadow: 0 0 15px rgba(255, 215, 0, 0.4);"><i class="fas fa-lightbulb"></i></div>
                        <div style="text-align: right; flex: 1;">
                            <div style="display:flex; align-items:center; gap:3px;">
                                <h3 id="student-type-text" class="typewriter-text"></h3><span class="typewriter-cursor"></span>
                            </div>
                            <div style="margin-top: 5px; display: inline-block; background: rgba(255,255,255,0.1); padding: 2px 8px; border-radius: 8px; font-size: 0.75rem; color: #aaa;">
                                <i class="fas fa-university"></i> منصة SA EDU
                            </div>
                        </div>
                    </div>
                </div>
                <div id="s-exams-list"></div>
            </section>

            <section id="s-reese" class="app-section hidden full-width-section">
                <div class="mobile-spacer"></div>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding: 0 15px;">
                    <h2 style="margin:0; font-family:'Outfit', sans-serif;">Reese SA</h2>
                    <button class="icon-btn-small" style="background:rgba(255,255,255,0.05); width:40px; height:40px;" onclick="toggleMyPostsView()">
                        <i class="fas fa-eraser" id="s-eraser-icon" style="color:#aaa;"></i>
                    </button>
                </div>
                <div class="reese-input-trigger" onclick="openReeseCompose()">
                    <div class="reese-avatar-mini" id="reese-trigger-avatar-s"></div>
                    <div class="reese-placeholder">شارك أفكارك مع الجميع...</div>
                    <div style="display:flex; gap:6px; align-items:center;">
                        <i class="fas fa-image" style="color:#555; font-size:1rem;"></i>
                        <i class="fas fa-paper-plane" style="color:var(--accent-primary); font-size:1rem;"></i>
                    </div>
                </div>
                <div id="reese-feed-container-s" class="feed-container"></div>
            </section>

            <section id="s-dardasha" class="app-section hidden" style="padding: 0; max-width: 100%;">
                <div class="chat-layout">
                    <div class="chat-sidebar" id="s-chat-sidebar">
                        <div class="chat-sidebar-header">
                            <div class="my-chat-info" onclick="openMyProfileModal()">
                                <div class="avatar-frame mini-frame" id="s-chat-my-avatar"></div>
                                <span>دردشة</span>
                            </div>
                            <button class="icon-btn-small" onclick="toggleUserSearchModal()"><i class="fas fa-plus"></i></button>
                        </div>
                        <div class="chat-search-bar">
                            <i class="fas fa-search"></i>
                            <input type="text" placeholder="بحث في المحادثات..." onkeyup="filterChats('s', this.value)">
                        </div>
                        <div class="chat-list" id="s-chat-list"></div>
                    </div>
                    <div class="chat-window hidden" id="s-chat-window"></div>
                </div>
            </section>

            <section id="s-grades" class="app-section hidden">
                <div class="mobile-spacer"></div>
                <h2 style="margin-bottom: 20px;">لوحة الشرف (درجاتي)</h2>
                <div id="s-grades-list"></div>
            </section>

            <section id="s-ai" class="app-section hidden">
                <div class="ai-layout">
                    <div class="ai-top-bar">
                        <div style="display:flex; gap:10px;">
                            <button class="ai-action-btn new-chat" onclick="startNewChat('s')" title="محادثة جديدة"><i class="fas fa-plus"></i></button>
                            <button class="ai-action-btn history" onclick="toggleHistory(true)" title="السجل"><i class="fas fa-history"></i></button>
                            <button class="ai-action-btn incognito" id="s-incognito-btn" onclick="toggleIncognito('s')" title="محادثة مخفية"><i class="fas fa-user-secret"></i></button>
                        </div>
                        <div style="display:flex; gap:10px;">
                            <button class="ai-action-btn" onclick="shareCurrentChat()" title="مشاركة المحادثة"><i class="fas fa-share-nodes"></i></button>
                        </div>
                    </div>
                    <div class="ai-messages" id="s-ai-msgs"></div>
                    
                    <div class="gemini-input-wrapper">
                        <div class="gemini-input-container">
                            <label for="s-ai-file" class="gemini-img-btn" title="إرفاق صورة"><i class="fas fa-camera"></i></label>
                            <input type="file" id="s-ai-file" hidden accept="image/*" onchange="previewChatImg('s')">
                            
                            <input type="text" id="s-ai-input" class="gemini-text-input" placeholder="اسألني عن أي شيء..." oninput="toggleAiSendMic('s', this.value)">
                            
                            <button id="s-mic-btn" class="gemini-mic-btn" onclick="startVoiceInput('s')" title="إدخال صوتي"><i class="fas fa-microphone"></i></button>
                            <button id="s-send-btn" onclick="sendAiMsg('s')" class="gemini-send-btn" style="display:none"><i class="fas fa-paper-plane"></i></button>
                        </div>
                         <div id="s-chat-preview" class="chat-img-preview">
                            <i class="fas fa-times" onclick="clearChatImg('s')"></i>
                            <img src="" id="s-chat-img-tag">
                        </div>
                    </div>
                </div>
            </section>

            <section id="s-taking-test" class="app-section hidden" style="position: fixed; inset: 0; background: #000; z-index: 3000; padding: 20px; overflow-y: auto;">
                <div style="max-width: 800px; margin: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <button class="back-btn-header" onclick="closeExam()"><i class="fas fa-sign-out-alt"></i> خروج</button>
                        <div id="test-timer" style="font-size: 1.5rem; font-weight: bold; color: var(--accent-primary);">00:00</div>
                    </div>
                    <h2 id="active-test-title" style="text-align: center; color: var(--accent-gold); margin-bottom: 30px;">...</h2>
                    <div id="test-questions-render" style="margin-bottom: 60px;"></div>
                    <button onclick="submitExam()" class="modern-btn" style="background: var(--success); color: white; margin-bottom: 50px;">تسليم الإجابة</button>
                </div>
            </section>
            
            <section id="s-review-test" class="app-section hidden" style="position: fixed; inset: 0; background: #000; z-index: 3000; padding: 20px; overflow-y: auto;">
                <div style="max-width: 800px; margin: auto;">
                    <div class="back-btn-header" onclick="document.getElementById('s-review-test').classList.add('hidden')"><i class="fas fa-arrow-right"></i> إغلاق المراجعة</div>
                    <h2 style="color: var(--accent-primary);">مراجعة الإجابات</h2>
                    <div id="review-content"></div>
                </div>
            </section>
        </div>
    </div>

    <div id="reese-compose-modal" class="compose-overlay">
        <div class="compose-header">
            <span style="font-weight: bold; font-size: 1.1rem;">إنشاء ريس جديد</span>
            <div style="cursor: pointer; padding: 10px;" onclick="closeReeseCompose()"><i class="fas fa-arrow-right fa-lg"></i></div>
        </div>
        <div class="compose-body">
            <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                <div class="avatar-frame" id="compose-avatar" style="width: 50px; height: 50px; font-size: 1.5rem; margin: 0; border-width: 1px;"></div>
                <div>
                    <div id="compose-name" style="font-weight: bold; margin-top: 5px;">User</div>
                    <div style="font-size: 0.8rem; color: #888; background: #222; width: fit-content; padding: 2px 8px; border-radius: 10px; margin-top: 2px;">عام</div>
                </div>
            </div>
            <textarea id="reese-text-input" class="compose-textarea" placeholder="بماذا تفكر؟" oninput="this.style.height='auto';this.style.height=(this.scrollHeight)+'px';"></textarea>
            
            <div id="ai-reese-suggestions" class="ai-suggestions-container hidden"></div>

            <div id="reese-media-preview" class="compose-media-preview hidden"></div>
            <button class="ai-suggestion-btn" onclick="generateAiReese()">
                <i class="fas fa-rotate"></i> تحديث الاقتراحات
            </button>
            <div style="margin-top: auto; display: flex; align-items: center; justify-content: space-between; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px;">
                <label class="add-media-btn" title="إضافة صور">
                    <i class="fas fa-camera-retro"></i>
                    <input type="file" id="reese-img-input" multiple accept="image/*" hidden onchange="handleReeseImageSelect(this)">
                </label>
                <button onclick="publishReese()" class="glossy-black-btn" style="width: auto; min-width: 100px;">
                    نشر <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <div id="menu-modal" class="full-screen-overlay">
        <button class="shiny-back-btn" onclick="toggleMenu()">
            <i class="fas fa-arrow-right"></i>
        </button>
        <div class="overlay-content">
            <div style="text-align: center; margin-bottom: 15px;">
                <div class="avatar-frame" id="menu-avatar" style="width: 100px; height: 100px; font-size: 3rem; border-width: 3px;"></div>
                <h3 id="menu-username" style="margin: 15px 0 5px; font-size: 1.3rem;">User</h3>
                <span id="menu-role" style="font-size: 0.85rem; background: #333; padding: 4px 15px; border-radius: 20px; color: #aaa;">Role</span>
            </div>

            <div id="menu-edit-section" class="hidden" style="background: #222; padding: 15px; border-radius: 15px;">
                <label style="color: #888; font-size: 0.8rem;">تعديل الاسم:</label>
                <div style="display: flex; gap: 10px; margin-top: 5px;">
                    <input type="text" id="edit-name-input" class="smart-input" style="margin: 0; padding: 10px;">
                    <button onclick="saveProfileName()" class="modern-btn" style="width: auto; padding: 0 20px; font-size: 0.9rem;">حفظ</button>
                </div>
            </div>
            <div id="menu-avatar-section" class="hidden">
                <p style="color: #aaa; font-size: 0.9rem; margin-bottom: 10px;">اختر شكلاً جديداً:</p>
                <div class="avatar-grid">
                    <div class="avatar-option" onclick="saveAvatar('fa-user-astronaut')"><i class="fas fa-user-astronaut"></i></div>
                    <div class="avatar-option" onclick="saveAvatar('fa-user-tie')"><i class="fas fa-user-tie"></i></div>
                    <div class="avatar-option" onclick="saveAvatar('fa-user-graduate')"><i class="fas fa-user-graduate"></i></div>
                    <div class="avatar-option" onclick="saveAvatar('fa-user-ninja')"><i class="fas fa-user-ninja"></i></div>
                    <div class="avatar-option" onclick="saveAvatar('fa-robot')"><i class="fas fa-robot"></i></div>
                    <div class="avatar-option" onclick="saveAvatar('fa-cat')"><i class="fas fa-cat"></i></div>
                    <div class="avatar-option" onclick="saveAvatar('fa-dragon')"><i class="fas fa-dragon"></i></div>
                    <div class="avatar-option" onclick="saveAvatar('fa-user-secret')"><i class="fas fa-user-secret"></i></div>
                </div>
            </div>
            <div class="menu-item" onclick="toggleEditProfile()">
                <i class="fas fa-user-edit" style="color: var(--accent-primary); font-size: 1.2rem;"></i>
                <span style="font-size: 1rem;">تعديل الملف الشخصي</span>
            </div>
            <div class="menu-item" onclick="toggleAvatarSelect()">
                <i class="fas fa-theater-masks" style="color: #d946ef; font-size: 1.2rem;"></i>
                <span style="font-size: 1rem;">تغيير الأفاتار</span>
            </div>
            <div class="menu-item" onclick="shareApp()">
                <i class="fas fa-share-alt" style="color: var(--success); font-size: 1.2rem;"></i>
                <span style="font-size: 1rem;">مشاركة المنصة</span>
            </div>
            <div style="margin-top: auto;">
                 <button class="glossy-black-btn danger" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> تسجيل الخروج
                </button>
            </div>
        </div>
    </div>

    <div id="profile-info-modal" class="hidden">
        <div class="bottom-sheet-content">
             <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                 <h3 style="margin:0;">الملف الشخصي</h3>
                 <button onclick="document.getElementById('profile-info-modal').classList.add('hidden')" style="background:none; border:none; color:#fff;"><i class="fas fa-times fa-lg"></i></button>
             </div>
             <div style="text-align:center; margin-bottom:20px;">
                 <div class="avatar-frame" id="pi-avatar" style="width:80px; height:80px; margin:0 auto 10px;"></div>
                 <h3 id="pi-name"></h3>
                 <div id="pi-id-box" class="copy-box" onclick="copyToClipboard(this.innerText)"></div>
                 <button class="modern-btn" onclick="copyProfileLink()" style="margin-top:15px; width:100%;"><i class="fas fa-link"></i> نسخ رابط المحادثة</button>
             </div>
        </div>
    </div>

    <div id="user-search-modal" class="hidden">
        <div class="bottom-sheet-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h3 style="margin:0; text-align:center;">بحث عن مستخدم</h3>
                <button onclick="document.getElementById('user-search-modal').classList.add('hidden')" style="background: rgba(255, 255, 255, 0.1); border: none; color: #fff; padding: 5px 12px; border-radius: 12px; font-size: 0.9rem; cursor: pointer;">خروج <i class="fas fa-times"></i></button>
            </div>
            
            <div class="chat-search-bar" style="margin-bottom:20px;">
                <input type="text" id="user-search-id-input" placeholder="أدخل معرف المستخدم (ID)...">
                <button onclick="searchUserById()" class="modern-btn" style="width:auto; min-width:60px;"><i class="fas fa-search"></i></button>
            </div>
            <div id="user-search-result"></div>
        </div>
    </div>

    <div id="ai-gen-modal" class="full-screen-overlay">
        <button class="shiny-back-btn" onclick="toggleAiGenerator()">
            <i class="fas fa-arrow-right"></i>
        </button>
        <div class="overlay-content">
            <div style="text-align: center; margin-bottom: 20px; padding: 30px 0;">
                <i class="fas fa-brain" style="font-size: 4rem; color: #d946ef; margin-bottom: 20px; text-shadow: 0 0 30px rgba(217, 70, 239, 0.4);"></i>
                <h2 style="margin: 0;">SA EDU AI</h2>
                <p style="color: #888;">حدد التفاصيل وسأقوم ببناء الاختبار لك</p>
            </div>
            <textarea id="ai-gen-text" class="smart-input" rows="4" placeholder="اكتب الموضوع هنا (مثال: الحرب العالمية الثانية، قوانين نيوتن...)" style="background: #111; border-color: #333;"></textarea>
            <label class="smart-input" style="display: flex; align-items: center; gap: 10px; cursor: pointer; background: #111; border-color: #333;">
                <i class="fas fa-image" style="color: var(--accent-primary);"></i> <span>رفع صورة للمنهج لتحليلها</span>
                <input type="file" id="ai-gen-img" hidden accept="image/*" onchange="previewAiGenImg(this)">
            </label>
            <div id="ai-gen-preview" class="hidden" style="margin-bottom: 15px; text-align: center;"><img src="" style="height: 100px; border-radius: 12px; border: 1px solid #333;"></div>
            
            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                <div style="flex: 1;">
                    <label style="color:#aaa; font-size:0.8rem; display:block; margin-bottom:5px;">عدد الاختياري (MCQ)</label>
                    <input type="number" id="ai-mcq-count" class="smart-input" value="5" style="text-align: center; margin: 0;">
                </div>
                <div style="flex: 1;">
                    <label style="color:#aaa; font-size:0.8rem; display:block; margin-bottom:5px;">عدد المقالي</label>
                    <input type="number" id="ai-essay-count" class="smart-input" value="0" style="text-align: center; margin: 0;">
                </div>
            </div>

            <div style="margin-top: auto;">
                <button onclick="generateAiQuestions()" class="glossy-black-btn">
                    <i class="fas fa-magic"></i> توليد الاختبار الآن
                </button>
            </div>
        </div>
    </div>

    <div id="phone-modal" class="hidden">
        <div class="bottom-sheet-content" style="background: #111; height: auto; text-align:center;">
            <i class="fas fa-mobile-alt" style="font-size: 3rem; color: var(--accent-primary); margin-bottom: 15px;"></i>
            <h3>مطلوب رقم للتواصل</h3>
            <p style="color:#aaa; font-size:0.9rem; margin-bottom:20px;">يرجى إدخال رقم هاتف ولي الأمر أو رقمك الشخصي لحفظ النتائج.</p>
            <input type="tel" id="student-phone-input" class="smart-input" placeholder="01xxxxxxxxx" style="text-align:center; font-size:1.1rem; letter-spacing:2px;">
            <button onclick="savePhoneAndStart()" class="modern-btn" style="margin-top:15px;">حفظ وبدء الاختبار</button>
        </div>
    </div>

    <div id="teacher-detail-modal" class="hidden">
        <div class="bottom-sheet-content" style="background: #111; max-height: 90vh;">
             <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                 <h3 style="margin:0;">تفاصيل الطالب</h3>
                 <button onclick="document.getElementById('teacher-detail-modal').classList.add('hidden')" style="background:none; border:none; color:#fff;"><i class="fas fa-times fa-lg"></i></button>
             </div>
             <div style="text-align:center; background:rgba(255,255,255,0.05); padding:15px; border-radius:15px; margin-bottom:20px;">
                 <div id="td-name" style="font-weight:bold; font-size:1.2rem;"></div>
                 <div id="td-phone" style="color:var(--accent-gold); font-size:1.1rem; margin-top:5px; font-family:monospace;"></div>
             </div>
             <h4 style="color:#888;">سجل الإجابات:</h4>
             <div id="td-answers-list" style="max-height: 50vh; overflow-y:auto;"></div>
        </div>
    </div>

    <div id="sa-custom-alert" class="">
        <div class="sa-alert-box">
            <div id="sa-alert-icon" class="sa-alert-icon"></div>
            <div id="sa-alert-title" class="sa-alert-title"></div>
            <div id="sa-alert-msg" class="sa-alert-msg"></div>
            <div id="sa-alert-actions" class="sa-alert-actions"></div>
        </div>
    </div>

    <div id="pwa-install-banner" class="hidden">
        <div class="pwa-content">
            <img src="https://i.postimg.cc/BQQb5YDn/MOWU-DESIGN.png" alt="SA EDU App" class="pwa-icon">
            <div class="pwa-info">
                <h4>تثبيت SA EDU</h4>
                <p>تجربة أفضل وأسرع</p>
            </div>
        </div>
        <div class="pwa-actions">
            <button class="pwa-btn close" onclick="closePWA()">إغلاق</button>
            <button class="pwa-btn install" onclick="installPWA()">تثبيت</button>
        </div>
    </div>

    <div id="sa-toast-container"></div>

    <div id="tab-dots" class="tab-dots hidden"></div>

    <script>
    function toggleAiSendMic(role, value) {
        const micBtn = document.getElementById(role + '-mic-btn');
        const sendBtn = document.getElementById(role + '-send-btn');
        if (!micBtn || !sendBtn) return;
        if (value && value.trim()) {
            micBtn.style.display = 'none';
            sendBtn.style.display = 'flex';
        } else {
            micBtn.style.display = 'flex';
            sendBtn.style.display = 'none';
        }
    }

    let mediaRecorder = null;
    let isRecording = false;

    function startVoiceInput(role) {
        const micBtn = document.getElementById(role + '-mic-btn');
        const input = document.getElementById(role + '-ai-input');
        
        if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
            if (typeof saAlert === 'function') {
                saAlert('❌', 'غير مدعوم', 'المتصفح لا يدعم الإدخال الصوتي. جرب Chrome أو Edge.');
            } else {
                alert('المتصفح لا يدعم الإدخال الصوتي. جرب Chrome.');
            }
            return;
        }

        if (isRecording) {
            if (window._speechRecog) window._speechRecog.stop();
            return;
        }

        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recog = new SpeechRecognition();
        window._speechRecog = recog;
        recog.lang = 'ar-SA';
        recog.continuous = false;
        recog.interimResults = false;

        recog.onstart = () => {
            isRecording = true;
            if (micBtn) micBtn.classList.add('recording');
        };

        recog.onresult = (e) => {
            const text = e.results[0][0].transcript;
            if (input) {
                input.value = (input.value + ' ' + text).trim();
                toggleAiSendMic(role, input.value);
            }
        };

        recog.onerror = () => {
            isRecording = false;
            if (micBtn) micBtn.classList.remove('recording');
        };

        recog.onend = () => {
            isRecording = false;
            if (micBtn) micBtn.classList.remove('recording');
        };

        recog.start();
    }
    </script>

    <script type="module" src="script.js"></script>
</body>
</html>

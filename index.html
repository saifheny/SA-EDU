<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>SA Educational Institution | ููุตุฉ ุงูุชุนููู ุงูุฐูู</title>
    <meta name="description" content="ููุตุฉ SA EDU ุงูุชุนููููุฉ ุงูุฑุงุฆุฏุฉุ ุงููุธุงู ุงููุชูุงูู ูุฅุฏุงุฑุฉ ุงูุชุนูู ูุงูุงุฎุชุจุงุฑุงุช ุงูุฅููุชุฑูููุฉ ุงููุฏุนูู ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู. ููุตุฉ ุดุงููุฉ ููุทูุงุจ ูุงููุนููููุ ุงุฎุชุจุงุฑุงุช ุชูุงุนููุฉุ ุชุตุญูุญ ุชููุงุฆูุ ูุณุงุนุฏ ุฏุฑุงุณู ุฐููุ ูุดุจูุฉ ุชูุงุตู ุชุนููููุฉ. ุชุบุทูุฉ ุดุงููุฉ ููููุงูุฌ ุงูุฏุฑุงุณูุฉ ูููุฑุงุญู ุงูุงุจุชุฏุงุฆูุฉุ ุงูุฅุนุฏุงุฏูุฉุ ูุงูุซุงูููุฉ.">
    <meta name="keywords" content="ุชุนููู, ููุตุฉ ุชุนููููุฉ, ุงุฎุชุจุงุฑุงุช ุงูููุงูู, ุฐูุงุก ุงุตุทูุงุนู ูู ุงูุชุนููู, SA EDU, SA Educational, ูุธุงู ุฅุฏุงุฑุฉ ุงูุชุนูู, LMS, ุงูุชุญุงูุงุช ุงููุชุฑูููุฉ, ุชุตุญูุญ ุชููุงุฆู, ุจูู ุฃุณุฆูุฉ, ุงูุซุงูููุฉ ุงูุนุงูุฉ, ุงูููุงูุฌ ุงููุตุฑูุฉ, ุงูููุงูุฌ ุงูุณุนูุฏูุฉ, ุชุนููู ุงููุชุฑููู, ูุฑุงุฌุนุงุช ููุงุฆูุฉ, ููุฒูุงุก, ููููุงุก, ุฑูุงุถูุงุช, ุฃุญูุงุก, ูุบุฉ ุนุฑุจูุฉ, ูุบุฉ ุงูุฌููุฒูุฉ, ุงูุตู ุงูุฃูู ุงูุซุงููู, ุงูุตู ุงูุซุงูู ุงูุซุงููู, ุงูุตู ุงูุซุงูุซ ุงูุซุงููู, ุงููุฑุญูุฉ ุงูุฅุนุฏุงุฏูุฉ, ุงููุฑุญูุฉ ุงูุงุจุชุฏุงุฆูุฉ, ูุณุงุนุฏ ุฐูู, ุญู ูุงุฌุจุงุช, ูุฏุฑุณ ุฎุตูุตู, ููุตุฉ ุฑูุณ, ุฏุฑุฏุดุฉ ุชุนููููุฉ, ุชุทุจูู ุชุนูููู, ุชุนููู ุนู ุจุนุฏ, ูุตูู ุงูุชุฑุงุถูุฉ, ูุชุงุฆุฌ ุงูุทูุงุจ, ูุชุงุจุนุฉ ููู ุงูุฃูุฑ, ุงูุฐูุงุก ุงูุงุตุทูุงุนู, AI Education, EdTech, E-learning Platform, Online Exams">
    <meta name="author" content="SA Educational Institution">
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
    <meta property="og:locale" content="ar_AR">
    <meta property="og:type" content="website">
    <meta property="og:title" content="SA Educational Institution | ูุณุชูุจู ุงูุชุนููู ุจูู ูุฏูู">
    <meta property="og:description" content="ุงูุถู ุฅูู ุฃููู ููุตุฉ ุชุนููููุฉ ูุฏุนููุฉ ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู. ุงุฎุชุจุงุฑุงุชุ ูุฑุงุฌุนุงุชุ ููุฌุชูุน ุทูุงุจู ูุชูุงูู.">
    <meta property="og:url" content="https://sa-edu.com">
    <meta property="og:site_name" content="SA EDU">
    <meta property="og:image" content="https://i.postimg.cc/BQQb5YDn/MOWU-DESIGN.png">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="SA Educational Institution | ุงูุชุนููู ุงูุฐูู">
    <meta name="twitter:description" content="ููุตุฉ ุชุนููููุฉ ูุชูุงููุฉ ููุทูุงุจ ูุงููุนูููู. ุฐูุงุก ุงุตุทูุงุนูุ ุงุฎุชุจุงุฑุงุชุ ูุชูุงุตู ูุนุงู.">
    <meta name="twitter:image" content="https://i.postimg.cc/BQQb5YDn/MOWU-DESIGN.png">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="manifest.json">
    <link rel="canonical" href="https://sa-edu.com">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&family=Outfit:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/@phosphor-icons/web@2.1.1/src/index.js" defer></script>
    <link rel="stylesheet" href="style.css">
    <script src='https://unpkg.com/tesseract.js@v2.1.0/dist/tesseract.min.js'></script>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "EducationalOrganization",
      "name": "SA Educational Institution",
      "url": "https://sa-edu.com",
      "logo": "https://i.postimg.cc/BQQb5YDn/MOWU-DESIGN.png",
      "sameAs": [
        "https://facebook.com/sa-edu",
        "https://twitter.com/sa-edu",
        "https://instagram.com/sa-edu"
      ],
      "description": "ููุตุฉ ุชุนููููุฉ ูุชุทูุฑุฉ ุชูุฏู ุฎุฏูุงุช ุงูุงุฎุชุจุงุฑุงุช ุงูุฅููุชุฑูููุฉ ูุงูุชุนููู ุงููุฏุนูู ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู ููุทูุงุจ ูุงููุนูููู.",
      "knowsAbout": ["Education", "Artificial Intelligence", "E-Learning", "Exams", "Curriculum"]
    }
    </script>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "SA EDU App",
      "applicationCategory": "EducationalApplication",
      "operatingSystem": "All",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "EGP"
      }
    }
    </script>
</head>
<body>
    <audio id="snd-click" src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3" preload="auto"></audio>
    <audio id="snd-sent" src="https://assets.mixkit.co/active_storage/sfx/2354/2354-preview.mp3" preload="auto"></audio>
    <audio id="snd-recv" src="https://assets.mixkit.co/active_storage/sfx/2358/2358-preview.mp3" preload="auto"></audio>
    <audio id="snd-success" src="https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.mp3" preload="auto"></audio>
    <audio id="snd-like" src="https://assets.mixkit.co/active_storage/sfx/2580/2580-preview.mp3" preload="auto"></audio>

    <div id="construction-overlay">
        <div class="construction-loader"></div>
        <div class="construction-text">SA AI Building...</div>
        <div class="construction-sub">ุฌุงุฑู ุจูุงุก ูุชุฌููุฒ ุงูุจูุงูุงุช</div>
    </div>

    <div id="landing-layer">
        <div class="landing-wrap">
            <h1 style="font-size: 3.5rem; background: linear-gradient(to right, #fff, #3b82f6); -webkit-background-clip: text; color: transparent; margin: 0; text-shadow: 0 0 30px rgba(59, 130, 246, 0.5);">SA EDU</h1>
            <div style="min-height: 40px; margin-top: 10px; display:flex; justify-content:center; align-items:center; gap:5px;">
                <span id="landing-type-text" class="landing-text"></span><span class="typewriter-cursor"></span>
            </div>
            <div style="margin-top: 30px;">
                <img src="https://i.postimg.cc/BQQb5YDn/MOWU-DESIGN.png" class="landing-avatar-img" alt="Logo">
            </div>
            <button onclick="goToAuth()" class="modern-btn" style="margin-top: 50px; font-size: 1.1rem; background: #ffffff; color: #000000; border: none; box-shadow: 0 0 30px rgba(255, 255, 255, 0.2); font-weight: 800; font-family: 'Outfit', sans-serif;">
                ENTER THE REALM <i class="fas fa-dungeon" style="margin-left: 8px;"></i>
            </button>
        </div>
    </div>

    <div id="auth-layer" class="hidden">
        <div class="flex-center" style="height: 100%; flex-direction: column; padding: 30px;">
            <div onclick="backToLanding()" style="position: absolute; top: 40px; right: 30px; cursor: pointer; padding: 10px;"><i class="fas fa-arrow-right fa-xl"></i></div>
            <h2 style="margin: 0 0 30px;">ุจูุงุจุฉ ุงูุฏุฎูู</h2>
            <div class="role-toggle-container">
                <button class="role-toggle-btn active" id="btn-role-student" onclick="setAuthRole('student')">ุทุงูุจ</button>
                <button class="role-toggle-btn" id="btn-role-teacher" onclick="setAuthRole('teacher')">ูุนูู</button>
            </div>
            <div id="auth-avatar-display" class="avatar-frame avatar-student" style="margin-bottom: 30px;">
                <i class="fas fa-user-astronaut"></i>
            </div>
            <div class="names-row">
                <input type="text" id="auth-name-1" class="smart-input" placeholder="ุงูุงุณู ุงูุฃูู" style="text-align: center;">
                <input type="text" id="auth-name-2" class="smart-input" placeholder="ุงูุงุณู ุงูุซุงูู" style="text-align: center;">
            </div>
            <input type="text" id="auth-name-3" class="smart-input" placeholder="ุงูุงุณู ุงูุซุงูุซ" style="text-align: center;">
            <input type="password" id="auth-pass" class="smart-input" placeholder="ุงูุฑูุฒ ุงูุณุฑู (6 ุฎุงูุงุช)" maxlength="6" style="text-align: center;">
            <button onclick="handleSmartAuth()" class="modern-btn" style="margin-top: 50px;">
                ุชุณุฌูู ุงูุฏุฎูู <i class="fas fa-sign-in-alt"></i>
            </button>
            <div id="auth-status" style="margin-top: 20px; color: var(--warning); font-size: 0.9rem;"></div>
        </div>
    </div>

    <div id="ai-history-sidebar" class="ai-history-sidebar">
        <div class="history-header">
            <span style="font-weight:bold; color:#fff;">ุณุฌู ุงููุญุงุฏุซุงุช</span>
            <i class="fas fa-times" onclick="toggleHistory(false)" style="cursor:pointer; color:#888;"></i>
        </div>
        <div class="history-list" id="ai-history-list"></div>
    </div>

    <div id="teacher-app" class="hidden">
        <nav class="top-nav">
            <div class="nav-container">
                <button class="nav-btn active" onclick="switchTab('t-library', this)"><i class="fas fa-layer-group"></i><span>ุงูููุชุจุฉ</span></button>
                <button class="nav-btn" onclick="switchTab('t-reese', this)"><i class="fas fa-feather-alt"></i><span>ุฑูุณ</span></button>
                <button class="nav-btn" onclick="switchTab('t-dardasha', this)"><i class="fab fa-telegram-plane"></i><span>ุฏุฑุฏุดุฉ</span></button>
                <button class="nav-btn magic-btn" onclick="switchTab('t-ai', this)"><i class="fas fa-wand-magic-sparkles"></i><span>AI</span></button>
                <button class="nav-btn" onclick="toggleMenu()"><i class="fas fa-bars"></i><span>ุงููุงุฆูุฉ</span></button>
            </div>
        </nav>
        <div class="portal-container">
            <section id="t-library" class="app-section">
                <div class="mobile-spacer"></div>
                <!-- Hero Avatar - Teacher -->
                <div class="section-avatar-hero" id="teacher-hero-section">
                    <div class="hero-avatar-ring teacher-ring" id="teacher-hero-avatar"><i class="fas fa-user-tie"></i></div>
                    <div class="hero-info">
                        <div class="hero-greeting">ุฃููุงูุ</div>
                        <div class="hero-name" id="teacher-hero-name">ุงููุนูู</div>
                        <div class="hero-status"><span class="status-dot"></span> ูุชุตู ุงูุขู</div>
                    </div>
                    <div style="text-align:left;">
                        <div style="font-size:0.7rem;color:#555;">ุงุฎุชุจุงุฑุงุชู</div>
                        <div style="font-size:1.1rem;font-weight:800;color:var(--accent-gold);" id="teacher-exam-count">0</div>
                    </div>
                </div>
                <div class="create-exam-cta" onclick="switchTab('t-create')">
                    <i class="fas fa-file-signature cta-bg-icon"></i>
                    <div class="cta-content">
                        <div class="cta-icon-wrapper"><i class="fas fa-plus"></i></div>
                        <div style="text-align: right; flex: 1;">
                            <div style="display:flex; align-items:center; gap:3px;">
                                <h3 id="cta-type-text" class="typewriter-text"></h3><span class="typewriter-cursor"></span>
                            </div>
                            <p style="margin: 4px 0 0; color: #ccc; font-size: 0.85rem;">ุงููุฑ ููุจุฏุก ูู ุฅูุดุงุก ุงุฎุชุจุงุฑ ุฌุฏูุฏ ููุทูุงุจ</p>
                        </div>
                    </div>
                    <div style="color: #666; position:relative; z-index:2;"><i class="fas fa-chevron-left"></i></div>
                </div>
                <div class="search-wrap-enhanced">
                    <div class="search-glow"></div>
                    <div class="search-inner" style="position:relative;">
                        <i class="fas fa-search search-icon-animated"></i>
                        <input type="text" class="google-bar" id="t-search" placeholder="ุงุจุญุซ ูู ุงุฎุชุจุงุฑุงุชู...">
                    </div>
                    <div class="search-categories">
                        <div class="search-cat-chip" onclick="filterExamsBySubject('ุฑูุงุถูุงุช')">๐ ุฑูุงุถูุงุช</div>
                        <div class="search-cat-chip" onclick="filterExamsBySubject('ุนููู')">๐ฌ ุนููู</div>
                        <div class="search-cat-chip" onclick="filterExamsBySubject('ุนุฑุจู')">๐ ุนุฑุจู</div>
                        <div class="search-cat-chip" onclick="filterExamsBySubject('ุฅูุฌููุฒู')">๐ฌ๐ง ุฅูุฌููุฒู</div>
                        <div class="search-cat-chip" onclick="filterExamsBySubject('ุชุงุฑูุฎ')">๐ ุชุงุฑูุฎ</div>
                    </div>
                </div>
                <div id="t-tests-list"></div>
            </section>

            <section id="t-reese" class="app-section hidden full-width-section">
                <div class="mobile-spacer"></div>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding: 0 15px;">
                    <h2 style="margin:0; font-family:'Outfit', sans-serif;">Reese SA</h2>
                    <button class="icon-btn-small" style="background:rgba(255,255,255,0.05); width:40px; height:40px;" onclick="toggleMyPostsView()">
                        <i class="fas fa-eraser" id="t-eraser-icon" style="color:#aaa;"></i>
                    </button>
                </div>
                <div class="reese-input-trigger" onclick="openReeseCompose()">
                    <div class="reese-avatar-mini" id="reese-trigger-avatar-t"></div>
                    <div class="reese-placeholder">ูุงุฐุง ูุฏูุฑ ูู ุฐููู ุงููููุ</div>
                    <div style="display:flex; gap:6px; align-items:center;">
                        <i class="fas fa-paper-plane" style="color:var(--accent-primary); font-size:1rem;"></i>
                    </div>
                </div>
                <div id="reese-feed-container-t" class="feed-container"></div>
            </section>

            <section id="t-dardasha" class="app-section hidden" style="padding: 0; max-width: 100%;">
                <div class="chat-layout">
                    <div class="chat-sidebar" id="t-chat-sidebar">
                        <div class="chat-sidebar-header">
                            <div class="my-chat-info" onclick="openMyProfileModal()">
                                <div class="avatar-frame mini-frame" id="t-chat-my-avatar"></div>
                                <span>ุฏุฑุฏุดุฉ</span>
                            </div>
                            <div style="display:flex;gap:6px;align-items:center;">
                                <button class="icon-btn-small voice-room-entry-btn" onclick="openVoiceRooms()" title="ุบุฑู ุงูุตูุช">
                                    <i class="ph-bold ph-microphone"></i>
                                </button>
                                <button class="icon-btn-small" onclick="toggleUserSearchModal()"><i class="fas fa-plus"></i></button>
                            </div>
                        </div>
                        <div class="chat-search-bar">
                            <i class="fas fa-search"></i>
                            <input type="text" placeholder="ุจุญุซ ูู ุงููุญุงุฏุซุงุช..." onkeyup="filterChats('t', this.value)">
                        </div>
                        <div class="chat-list" id="t-chat-list"></div>
                    </div>
                    <div class="chat-window hidden" id="t-chat-window">
                    </div>
                </div>
            </section>

            <section id="t-results" class="app-section hidden">
                <div class="mobile-spacer"></div>
                <div class="back-btn-header" onclick="switchTab('t-library')"><i class="fas fa-arrow-right"></i> ุงูุฑุฆูุณูุฉ</div>
                <h2>ูุชุงุฆุฌ ุงูุทูุงุจ</h2>
                <select id="t-result-select" class="smart-input" style="text-align: right;"><option>ุงุฎุชุฑ ุงูุงุฎุชุจุงุฑ ููุนุฑุถ</option></select>
                <div id="t-results-container"></div>
            </section>

            <section id="t-create" class="app-section hidden">
                <div class="mobile-spacer"></div>
                <div class="back-btn-header" onclick="resetCreateForm(); switchTab('t-library');"><i class="fas fa-arrow-right"></i> ุฅูุบุงุก</div>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="margin: 0;" id="create-page-title">ุงุฎุชุจุงุฑ ุฌุฏูุฏ</h2>
                    <button onclick="toggleAiGenerator()" style="background: rgba(217, 70, 239, 0.1); border: 1px solid #d946ef; color: #d946ef; padding: 6px 15px; border-radius: 20px; font-size: 0.8rem; display: flex; align-items: center; gap: 5px; font-weight: bold;">
                        <i class="fas fa-wand-magic-sparkles"></i> ุชูููุฏ ุจุงูู AI
                    </button>
                </div>
                <input type="text" id="new-test-name" class="smart-input" placeholder="ุนููุงู ุงูุงุฎุชุจุงุฑ (ูุซุงู: ููุฒูุงุก - ุงููุญุฏุฉ ุงูุฃููู)" style="font-weight: bold;">
                <div style="display: flex; gap: 10px;">
                    <select id="new-test-grade" class="smart-input" onchange="checkCustomGrade(this)">
                        <option value="" disabled selected>ุงูุตู ุงูุฏุฑุงุณู</option>
                        <option value="1p">ุงูุฃูู ุงูุงุจุชุฏุงุฆู</option>
                        <option value="2p">ุงูุซุงูู ุงูุงุจุชุฏุงุฆู</option>
                        <option value="3p">ุงูุซุงูุซ ุงูุงุจุชุฏุงุฆู</option>
                        <option value="4p">ุงูุฑุงุจุน ุงูุงุจุชุฏุงุฆู</option>
                        <option value="5p">ุงูุฎุงูุณ ุงูุงุจุชุฏุงุฆู</option>
                        <option value="6p">ุงูุณุงุฏุณ ุงูุงุจุชุฏุงุฆู</option>
                        <option value="1m">ุงูุฃูู ุงูุฅุนุฏุงุฏู</option>
                        <option value="2m">ุงูุซุงูู ุงูุฅุนุฏุงุฏู</option>
                        <option value="3m">ุงูุซุงูุซ ุงูุฅุนุฏุงุฏู</option>
                        <option value="1s">ุงูุฃูู ุงูุซุงููู</option>
                        <option value="2s">ุงูุซุงูู ุงูุซุงููู</option>
                        <option value="3s">ุงูุซุงูุซ ุงูุซุงููู</option>
                        <option value="custom" style="color: var(--accent-gold);">-- ูุชุงุจุฉ ุตู ูุฎุตุต --</option>
                    </select>
                    <input type="number" id="new-test-duration" class="smart-input" placeholder="ุงููุฏุฉ (ุฏ)" style="width: 100px; text-align: center;">
                </div>
                <select id="new-test-subject" class="smart-input" style="margin-top:0; border-color: rgba(255,255,255,0.1);" required>
                    <option value="" disabled selected>๐ ุงุฎุชุฑ ุงููุงุฏุฉ (ูุทููุจ) *</option>
                    <option value="ุฑูุงุถูุงุช">๐ ุฑูุงุถูุงุช</option>
                    <option value="ููุฒูุงุก">โก ููุฒูุงุก</option>
                    <option value="ููููุงุก">๐งช ููููุงุก</option>
                    <option value="ุฃุญูุงุก">๐ฟ ุฃุญูุงุก</option>
                    <option value="ูุบุฉ ุนุฑุจูุฉ">๐ ูุบุฉ ุนุฑุจูุฉ</option>
                    <option value="ูุบุฉ ุฅูุฌููุฒูุฉ">๐ ูุบุฉ ุฅูุฌููุฒูุฉ</option>
                    <option value="ุชุงุฑูุฎ">๐๏ธ ุชุงุฑูุฎ</option>
                    <option value="ุฌุบุฑุงููุง">๐บ๏ธ ุฌุบุฑุงููุง</option>
                    <option value="ุนููู">๐ฌ ุนููู</option>
                    <option value="ุญุงุณุจ ุขูู">๐ป ุญุงุณุจ ุขูู</option>
                    <option value="ุฏุฑุงุณุงุช ุงุฌุชูุงุนูุฉ">๐ ุฏุฑุงุณุงุช ุงุฌุชูุงุนูุฉ</option>
                    <option value="ุชุฑุจูุฉ ุฏูููุฉ">๐ ุชุฑุจูุฉ ุฏูููุฉ</option>
                    <option value="ุฃุฎุฑู">๐ ุฃุฎุฑู</option>
                </select>
                <input type="text" id="custom-grade-input" class="smart-input hidden" placeholder="ุงูุชุจ ุงุณู ุงูุตู ููุง..." style="border-color: var(--accent-gold);">
                <div id="q-editor-box" style="background: #151515; padding: 20px; border-radius: 20px; border: 1px solid #333; margin-top: 20px;">
                    <h3 style="font-size: 1rem; color: #888; margin-top: 0; margin-bottom: 15px;">ุฅุถุงูุฉ ุณุคุงู</h3>
                    
                    <div class="type-toggle-container">
                        <label class="type-radio-label active" onclick="setQType('mcq', this)">
                            <i class="fas fa-list-ul"></i> ุงุฎุชูุงุฑู
                            <input type="radio" name="q-type" value="mcq" class="type-radio-input" checked>
                        </label>
                        <label class="type-radio-label" onclick="setQType('essay', this)">
                            <i class="fas fa-align-right"></i> ููุงูู
                            <input type="radio" name="q-type" value="essay" class="type-radio-input">
                        </label>
                    </div>

                    <textarea id="q-text" class="smart-input" rows="2" placeholder="ุงูุชุจ ูุต ุงูุณุคุงู"></textarea>
                    
                    <div id="mcq-section-wrapper">
                        <div id="mcq-options-container"></div>
                        <button onclick="addOptionField()" class="modern-btn secondary" style="width: auto; padding: 8px 15px; font-size: 0.8rem; margin-bottom: 15px;">
                            <i class="fas fa-plus"></i> ุฅุถุงูุฉ ุฎูุงุฑ ุขุฎุฑ
                        </button>
                    </div>

                    <div style="display: flex; gap: 10px; margin-top: 10px; border-top: 1px solid #333; padding-top: 15px;">
                        <input type="number" id="q-points" value="1" class="smart-input" style="width: 80px; text-align: center; margin:0;" placeholder="ุฏุฑุฌุฉ">
                        <label class="smart-input" style="flex: 1; text-align: center; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; border: 1px dashed #444; margin:0;">
                            <i class="fas fa-image"></i> <span id="q-img-label">ุฅุฑูุงู ุตูุฑุฉ</span>
                            <input type="file" id="q-image-input" hidden accept="image/*">
                        </label>
                    </div>
                    <div id="q-img-preview" class="hidden" style="margin-top: 10px; text-align: center;"><img src="" style="height: 80px; border-radius: 10px;"></div>
                    <button id="btn-add-q" onclick="addQuestionToList()" class="modern-btn" style="margin-top: 15px; background: #333; color: #fff;">
                        <i class="fas fa-check"></i> ุฅุถุงูุฉ ุงูุณุคุงู
                    </button>
                </div>
                <h3 style="margin-top: 30px; margin-bottom: 10px;">ุงูุฃุณุฆูุฉ ุงููุถุงูุฉ:</h3>
                <div id="added-questions-list" style="margin-bottom: 30px;"></div>
                <button id="btn-save-test" class="modern-btn" onclick="saveTest()" style="background: var(--success); color: white; margin-bottom: 50px;">
                    <i class="fas fa-save"></i> ูุดุฑ ุงูุงุฎุชุจุงุฑ ุงูููุงุฆู
                </button>
            </section>

            <section id="t-ai" class="app-section hidden">
                <div class="ai-layout">
                    <div class="ai-top-bar">
                        <div style="display:flex; gap:10px;">
                            <button class="ai-action-btn new-chat" onclick="startNewChat('t')" title="ูุญุงุฏุซุฉ ุฌุฏูุฏุฉ"><i class="fas fa-plus"></i></button>
                            <button class="ai-action-btn history" onclick="toggleHistory(true)" title="ุงูุณุฌู"><i class="fas fa-history"></i></button>
                            <button class="ai-action-btn incognito" id="t-incognito-btn" onclick="toggleIncognito('t')" title="ูุญุงุฏุซุฉ ูุฎููุฉ"><i class="fas fa-user-secret"></i></button>
                        </div>
                        <div style="display:flex; gap:10px;">
                            <button class="ai-action-btn" onclick="shareCurrentChat()" title="ูุดุงุฑูุฉ ุงููุญุงุฏุซุฉ"><i class="fas fa-share-nodes"></i></button>
                        </div>
                    </div>
                    <div class="ai-messages" id="t-ai-msgs"></div>
                    
                    <div class="gemini-input-wrapper">
                        <div class="gemini-input-container">
                            <label for="t-ai-file" class="gemini-img-btn" title="ุฅุฑูุงู ุตูุฑุฉ"><i class="fas fa-camera"></i></label>
                            <input type="file" id="t-ai-file" hidden accept="image/*" onchange="previewChatImg('t')">
                            
                            <input type="text" id="t-ai-input" class="gemini-text-input" placeholder="ุงูุชุจุ ุชุฎููุ ุฃูุดุฆ..." oninput="toggleAiSendMic('t', this.value)">
                            
                            <button id="t-mic-btn" class="gemini-mic-btn" onclick="startVoiceInput('t')" title="ุฅุฏุฎุงู ุตูุชู"><i class="fas fa-microphone"></i></button>
                            <button id="t-send-btn" onclick="sendAiMsg('t')" class="gemini-send-btn" style="display:none"><i class="fas fa-paper-plane"></i></button>
                        </div>
                        <div id="t-chat-preview" class="chat-img-preview">
                            <i class="fas fa-times" onclick="clearChatImg('t')"></i>
                            <img src="" id="t-chat-img-tag">
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <div id="student-app" class="hidden">
        <nav class="top-nav">
            <div class="nav-container">
                <button class="nav-btn active" onclick="switchTab('s-exams', this)"><i class="fas fa-book-open"></i><span>ุงุฎุชุจุงุฑุงุช</span></button>
                <button class="nav-btn" onclick="switchTab('s-reese', this)"><i class="fas fa-feather-alt"></i><span>ุฑูุณ</span></button>
                <button class="nav-btn" onclick="switchTab('s-dardasha', this)"><i class="fab fa-telegram-plane"></i><span>ุฏุฑุฏุดุฉ</span></button>
                <button class="nav-btn magic-btn" onclick="switchTab('s-ai', this)"><i class="fas fa-wand-magic-sparkles"></i><span>AI</span></button>
                <button class="nav-btn" onclick="toggleMenu()"><i class="fas fa-bars"></i><span>ุงููุงุฆูุฉ</span></button>
            </div>
        </nav>
        <div class="portal-container">
            <section id="s-exams" class="app-section">
                <div class="mobile-spacer"></div>
                <!-- Hero Avatar - Student -->
                <div class="section-avatar-hero" id="student-hero-section">
                    <div class="hero-avatar-ring" id="student-hero-avatar"><i class="fas fa-user-astronaut"></i></div>
                    <div class="hero-info">
                        <div class="hero-greeting">ูุฑุญุจุงูุ</div>
                        <div class="hero-name" id="student-hero-name">ุงูุทุงูุจ</div>
                        <div class="hero-status"><span class="status-dot"></span> ุฌุงูุฒ ููุชุนูู</div>
                    </div>
                    <div style="text-align:left;">
                        <div style="font-size:0.7rem;color:#555;">ููุงุทู</div>
                        <div style="font-size:1.1rem;font-weight:800;color:var(--accent-primary);" id="student-hero-xp">0 XP</div>
                    </div>
                </div>
                <div id="xp-hud" class="xp-hud">
                    <div class="xp-hud-top">
                        <div class="xp-level-badge" id="xp-level-badge">
                            <i class="fas fa-star"></i> <span id="xp-level-name">ูุจุชุฏุฆ</span>
                        </div>
                        <div class="xp-streak" id="xp-streak-display">
                            <i class="fas fa-fire" style="color:#f97316;"></i> <span id="xp-streak-count">0</span> ููู
                        </div>
                        <div class="xp-total" id="xp-total-display">
                            <i class="fas fa-bolt" style="color:var(--accent-gold);"></i> <span id="xp-total-count">0</span> XP
                        </div>
                    </div>
                    <div class="xp-daily-goal-wrap">
                        <div class="xp-daily-goal-label">
                            <span>ูุฏู ุงูููู</span>
                            <span id="xp-daily-label">0 / 50 XP</span>
                        </div>
                        <div class="xp-daily-bar">
                            <div class="xp-daily-fill" id="xp-daily-fill" style="width:0%"></div>
                        </div>
                    </div>
                    <div class="xp-badges-row" id="xp-badges-row"></div>
                </div>
                <div class="search-wrap-enhanced">
                    <div class="search-glow"></div>
                    <div class="search-inner" style="position:relative;">
                        <i class="fas fa-search search-icon-animated"></i>
                        <input type="text" class="google-bar" id="s-search" placeholder="ุงุจุญุซ ุนู ุงุฎุชุจุงุฑ...">
                    </div>
                    <div class="search-categories">
                        <div class="search-cat-chip" onclick="filterStudentExams('ุฑูุงุถูุงุช')">๐ ุฑูุงุถูุงุช</div>
                        <div class="search-cat-chip" onclick="filterStudentExams('ุนููู')">๐ฌ ุนููู</div>
                        <div class="search-cat-chip" onclick="filterStudentExams('ุนุฑุจู')">๐ ุนุฑุจู</div>
                        <div class="search-cat-chip" onclick="filterStudentExams('ุฅูุฌููุฒู')">๐ฌ๐ง ุฅูุฌููุฒู</div>
                        <div class="search-cat-chip" onclick="filterStudentExams('ููุฒูุงุก')">โก ููุฒูุงุก</div>
                        <div class="search-cat-chip" onclick="filterStudentExams('ููููุงุก')">๐งช ููููุงุก</div>
                    </div>
                </div>
                <div class="create-exam-cta student-stats-cta" onclick="openStudentAnalytics()">
                    <i class="fas fa-chart-line cta-bg-icon"></i>
                    <div class="cta-content">
                        <div class="cta-icon-wrapper"><i class="fas fa-chart-pie"></i></div>
                        <div style="text-align: right; flex: 1;">
                            <div style="display:flex; align-items:center; gap:3px;">
                                <h3 id="student-type-text" class="typewriter-text"></h3><span class="typewriter-cursor"></span>
                            </div>
                            <div style="margin-top: 5px; display: inline-block; background: rgba(255,255,255,0.1); padding: 2px 8px; border-radius: 8px; font-size: 0.75rem; color: #aaa;">
                                <i class="fas fa-university"></i> ููุตุฉ SA EDU
                            </div>
                        </div>
                    </div>
                </div>
                <div id="s-exams-list"></div>
            </section>

            <section id="s-analytics" class="app-section hidden">
                <div class="mobile-spacer"></div>
                <div class="back-btn-header" onclick="switchTab('s-exams')"><i class="fas fa-arrow-right"></i> ุฑุฌูุน</div>
                <h2 style="margin-bottom: 20px;">ุชุญููู ุงููุณุชูู ุงูุฏุฑุงุณู</h2>
                <div id="student-analytics-content">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <i class="fas fa-spinner fa-spin"></i> ุฌุงุฑู ุงูุชุญููู...
                    </div>
                </div>
            </section>

            <section id="s-reese" class="app-section hidden full-width-section">
                <div class="mobile-spacer"></div>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding: 0 15px;">
                    <h2 style="margin:0; font-family:'Outfit', sans-serif;">Reese SA</h2>
                    <button class="icon-btn-small" style="background:rgba(255,255,255,0.05); width:40px; height:40px;" onclick="toggleMyPostsView()">
                        <i class="fas fa-eraser" id="s-eraser-icon" style="color:#aaa;"></i>
                    </button>
                </div>
                <div class="reese-input-trigger" onclick="openReeseCompose()">
                    <div class="reese-avatar-mini" id="reese-trigger-avatar-s"></div>
                    <div class="reese-placeholder">ุดุงุฑู ุฃููุงุฑู ูุน ุงูุฌููุน...</div>
                    <div style="display:flex; gap:6px; align-items:center;">
                        <i class="fas fa-paper-plane" style="color:var(--accent-primary); font-size:1rem;"></i>
                    </div>
                </div>
                <div id="reese-feed-container-s" class="feed-container"></div>
            </section>

            <section id="s-dardasha" class="app-section hidden" style="padding: 0; max-width: 100%;">
                <div class="chat-layout">
                    <div class="chat-sidebar" id="s-chat-sidebar">
                        <div class="chat-sidebar-header">
                            <div class="my-chat-info" onclick="openMyProfileModal()">
                                <div class="avatar-frame mini-frame" id="s-chat-my-avatar"></div>
                                <span>ุฏุฑุฏุดุฉ</span>
                            </div>
                            <div style="display:flex;gap:6px;align-items:center;">
                                <button class="icon-btn-small voice-room-entry-btn" onclick="openVoiceRooms()" title="ุบุฑู ุงูุตูุช">
                                    <i class="ph-bold ph-microphone"></i>
                                </button>
                                <button class="icon-btn-small" onclick="toggleUserSearchModal()"><i class="fas fa-plus"></i></button>
                            </div>
                        </div>
                        <div class="chat-search-bar">
                            <i class="fas fa-search"></i>
                            <input type="text" placeholder="ุจุญุซ ูู ุงููุญุงุฏุซุงุช..." onkeyup="filterChats('s', this.value)">
                        </div>
                        <div class="chat-list" id="s-chat-list"></div>
                    </div>
                    <div class="chat-window hidden" id="s-chat-window"></div>
                </div>
            </section>

            <section id="s-grades" class="app-section hidden">
                <div class="mobile-spacer"></div>
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <h2 style="margin:0;">ููุญุฉ ุงูุดุฑู (ุฏุฑุฌุงุชู)</h2>
                    <button onclick="openLeaderboard()" style="background:rgba(255,215,0,0.1); border:1px solid rgba(255,215,0,0.3); color:var(--accent-gold); padding:8px 14px; border-radius:20px; font-size:0.85rem; cursor:pointer; display:flex; align-items:center; gap:6px; font-family:var(--font-main);">
                        <i class="fas fa-trophy"></i> ุงููุชุตุฏุฑูู
                    </button>
                </div>
                <div id="s-grades-list"></div>
            </section>

            <section id="s-ai" class="app-section hidden">
                <div class="ai-layout">
                    <div class="ai-top-bar">
                        <div style="display:flex; gap:10px;">
                            <button class="ai-action-btn new-chat" onclick="startNewChat('s')" title="ูุญุงุฏุซุฉ ุฌุฏูุฏุฉ"><i class="fas fa-plus"></i></button>
                            <button class="ai-action-btn history" onclick="toggleHistory(true)" title="ุงูุณุฌู"><i class="fas fa-history"></i></button>
                            <button class="ai-action-btn incognito" id="s-incognito-btn" onclick="toggleIncognito('s')" title="ูุญุงุฏุซุฉ ูุฎููุฉ"><i class="fas fa-user-secret"></i></button>
                        </div>
                        <div style="display:flex; gap:10px;">
                            <button class="ai-action-btn" onclick="shareCurrentChat()" title="ูุดุงุฑูุฉ ุงููุญุงุฏุซุฉ"><i class="fas fa-share-nodes"></i></button>
                        </div>
                    </div>
                    <div class="ai-messages" id="s-ai-msgs"></div>
                    
                    <div class="gemini-input-wrapper">
                        <div class="gemini-input-container">
                            <label for="s-ai-file" class="gemini-img-btn" title="ุฅุฑูุงู ุตูุฑุฉ"><i class="fas fa-camera"></i></label>
                            <input type="file" id="s-ai-file" hidden accept="image/*" onchange="previewChatImg('s')">
                            
                            <input type="text" id="s-ai-input" class="gemini-text-input" placeholder="ุงุณุฃููู ุนู ุฃู ุดูุก..." oninput="toggleAiSendMic('s', this.value)">
                            
                            <button id="s-mic-btn" class="gemini-mic-btn" onclick="startVoiceInput('s')" title="ุฅุฏุฎุงู ุตูุชู"><i class="fas fa-microphone"></i></button>
                            <button id="s-send-btn" onclick="sendAiMsg('s')" class="gemini-send-btn" style="display:none"><i class="fas fa-paper-plane"></i></button>
                        </div>
                         <div id="s-chat-preview" class="chat-img-preview">
                            <i class="fas fa-times" onclick="clearChatImg('s')"></i>
                            <img src="" id="s-chat-img-tag">
                        </div>
                    </div>
                </div>
            </section>

            <section id="s-taking-test" class="app-section hidden" style="position: fixed; inset: 0; background: #000; z-index: 3000; padding: 20px; overflow-y: auto;">
                <div style="max-width: 800px; margin: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <button class="back-btn-header" onclick="closeExam()"><i class="fas fa-sign-out-alt"></i> ุฎุฑูุฌ</button>
                        <div id="test-timer" style="font-size: 1.5rem; font-weight: bold; color: var(--accent-primary);">00:00</div>
                    </div>
                    <h2 id="active-test-title" style="text-align: center; color: var(--accent-gold); margin-bottom: 30px;">...</h2>
                    <div id="test-questions-render" style="margin-bottom: 60px;"></div>
                    <button onclick="submitExam()" class="modern-btn" style="background: var(--success); color: white; margin-bottom: 50px;">ุชุณููู ุงูุฅุฌุงุจุฉ</button>
                </div>
            </section>
            
            <section id="s-review-test" class="app-section hidden" style="position: fixed; inset: 0; background: #000; z-index: 3000; padding: 20px; overflow-y: auto;">
                <div style="max-width: 800px; margin: auto;">
                    <div class="back-btn-header" onclick="document.getElementById('s-review-test').classList.add('hidden')"><i class="fas fa-arrow-right"></i> ุฅุบูุงู ุงููุฑุงุฌุนุฉ</div>
                    <h2 style="color: var(--accent-primary);">ูุฑุงุฌุนุฉ ุงูุฅุฌุงุจุงุช</h2>
                    <div id="review-content"></div>
                </div>
            </section>
        </div>
    </div>

    <div id="reese-compose-modal" class="compose-overlay">
        <div class="compose-header">
            <span style="font-weight: bold; font-size: 1.1rem;">ุฅูุดุงุก ุฑูุณ ุฌุฏูุฏ</span>
            <div style="cursor: pointer; padding: 10px;" onclick="closeReeseCompose()"><i class="fas fa-arrow-right fa-lg"></i></div>
        </div>
        <div class="compose-body">
            <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                <div class="avatar-frame" id="compose-avatar" style="width: 50px; height: 50px; font-size: 1.5rem; margin: 0; border-width: 1px;"></div>
                <div>
                    <div id="compose-name" style="font-weight: bold; margin-top: 5px;">User</div>
                    <div style="font-size: 0.8rem; color: #888; background: #222; width: fit-content; padding: 2px 8px; border-radius: 10px; margin-top: 2px;">ุนุงู</div>
                </div>
            </div>
            <textarea id="reese-text-input" class="compose-textarea" placeholder="ุจูุงุฐุง ุชููุฑุ" oninput="this.style.height='auto';this.style.height=(this.scrollHeight)+'px';"></textarea>
            
            <div id="ai-reese-suggestions" class="ai-suggestions-container hidden"></div>

            <div id="reese-media-preview" class="compose-media-preview hidden"></div>
            <button class="ai-suggestion-btn" onclick="generateAiReese()">
                <i class="fas fa-rotate"></i> ุชุญุฏูุซ ุงูุงูุชุฑุงุญุงุช
            </button>
            <div style="margin-top: auto; display: flex; align-items: center; justify-content: space-between; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px;">
                <label class="add-media-btn" title="ุฅุถุงูุฉ ุตูุฑ">
                    <i class="fas fa-camera-retro"></i>
                    <input type="file" id="reese-img-input" multiple accept="image/*" hidden onchange="handleReeseImageSelect(this)">
                </label>
                <button onclick="publishReese()" class="glossy-black-btn" style="width: auto; min-width: 100px;">
                    ูุดุฑ <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <div id="menu-modal" class="full-screen-overlay">
        <button class="shiny-back-btn" onclick="toggleMenu()">
            <i class="fas fa-arrow-right"></i>
        </button>
        <div class="overlay-content">
            <div style="text-align: center; margin-bottom: 15px;">
                <div class="avatar-frame" id="menu-avatar" style="width: 100px; height: 100px; font-size: 3rem; border-width: 3px;"></div>
                <h3 id="menu-username" style="margin: 15px 0 5px; font-size: 1.3rem;">User</h3>
                <span id="menu-role" style="font-size: 0.85rem; background: #333; padding: 4px 15px; border-radius: 20px; color: #aaa;">Role</span>
            </div>

            <div id="menu-edit-section" class="hidden" style="background: #222; padding: 15px; border-radius: 15px;">
                <label style="color: #888; font-size: 0.8rem;">ุชุนุฏูู ุงูุงุณู:</label>
                <div style="display: flex; gap: 10px; margin-top: 5px;">
                    <input type="text" id="edit-name-input" class="smart-input" style="margin: 0; padding: 10px;">
                    <button onclick="saveProfileName()" class="modern-btn" style="width: auto; padding: 0 20px; font-size: 0.9rem;">ุญูุธ</button>
                </div>
            </div>
            <div id="menu-avatar-section" class="hidden">
                <p style="color: #aaa; font-size: 0.9rem; margin-bottom: 10px;">ุงุฎุชุฑ ุดููุงู ุฌุฏูุฏุงู:</p>
                <div class="avatar-grid">
                    <div class="avatar-option" onclick="saveAvatar('fa-user-astronaut')"><i class="fas fa-user-astronaut"></i></div>
                    <div class="avatar-option" onclick="saveAvatar('fa-user-tie')"><i class="fas fa-user-tie"></i></div>
                    <div class="avatar-option" onclick="saveAvatar('fa-user-graduate')"><i class="fas fa-user-graduate"></i></div>
                    <div class="avatar-option" onclick="saveAvatar('fa-user-ninja')"><i class="fas fa-user-ninja"></i></div>
                    <div class="avatar-option" onclick="saveAvatar('fa-robot')"><i class="fas fa-robot"></i></div>
                    <div class="avatar-option" onclick="saveAvatar('fa-cat')"><i class="fas fa-cat"></i></div>
                    <div class="avatar-option" onclick="saveAvatar('fa-dragon')"><i class="fas fa-dragon"></i></div>
                    <div class="avatar-option" onclick="saveAvatar('fa-user-secret')"><i class="fas fa-user-secret"></i></div>
                </div>
            </div>
            <div class="menu-item" onclick="toggleEditProfile()">
                <i class="fas fa-user-edit" style="color: var(--accent-primary); font-size: 1.2rem;"></i>
                <span style="font-size: 1rem;">ุชุนุฏูู ุงูููู ุงูุดุฎุตู</span>
            </div>
            <div class="menu-item" onclick="toggleAvatarSelect()">
                <i class="fas fa-theater-masks" style="color: #d946ef; font-size: 1.2rem;"></i>
                <span style="font-size: 1rem;">ุชุบููุฑ ุงูุฃูุงุชุงุฑ</span>
            </div>
            <div class="menu-item" onclick="shareApp()">
                <i class="fas fa-share-alt" style="color: var(--success); font-size: 1.2rem;"></i>
                <span style="font-size: 1rem;">ูุดุงุฑูุฉ ุงูููุตุฉ</span>
            </div>
            <div style="margin-top: auto;">
                 <button class="glossy-black-btn danger" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> ุชุณุฌูู ุงูุฎุฑูุฌ
                </button>
            </div>
        </div>
    </div>

    <div id="profile-info-modal" class="hidden">
        <div class="bottom-sheet-content">
             <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                 <h3 style="margin:0;">ุงูููู ุงูุดุฎุตู</h3>
                 <button onclick="document.getElementById('profile-info-modal').classList.add('hidden')" style="background:none; border:none; color:#fff;"><i class="fas fa-times fa-lg"></i></button>
             </div>
             <div style="text-align:center; margin-bottom:20px;">
                 <div class="avatar-frame" id="pi-avatar" style="width:80px; height:80px; margin:0 auto 10px;"></div>
                 <h3 id="pi-name"></h3>
                 <div id="pi-id-box" class="copy-box" onclick="copyToClipboard(this.innerText)"></div>
                 <button class="modern-btn" onclick="copyProfileLink()" style="margin-top:15px; width:100%;"><i class="fas fa-link"></i> ูุณุฎ ุฑุงุจุท ุงููุญุงุฏุซุฉ</button>
             </div>
        </div>
    </div>

    <div id="user-search-modal" class="hidden">
        <div class="bottom-sheet-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h3 style="margin:0; text-align:center;">ุจุญุซ ุนู ูุณุชุฎุฏู</h3>
                <button onclick="document.getElementById('user-search-modal').classList.add('hidden')" style="background: rgba(255, 255, 255, 0.1); border: none; color: #fff; padding: 5px 12px; border-radius: 12px; font-size: 0.9rem; cursor: pointer;">ุฎุฑูุฌ <i class="fas fa-times"></i></button>
            </div>
            
            <div class="chat-search-bar" style="margin-bottom:20px;">
                <input type="text" id="user-search-id-input" placeholder="ุฃุฏุฎู ูุนุฑู ุงููุณุชุฎุฏู (ID)...">
                <button onclick="searchUserById()" class="modern-btn" style="width:auto; min-width:60px;"><i class="fas fa-search"></i></button>
            </div>
            <div id="user-search-result"></div>
        </div>
    </div>

    <div id="ai-gen-modal" class="full-screen-overlay">
        <button class="shiny-back-btn" onclick="toggleAiGenerator()">
            <i class="fas fa-arrow-right"></i>
        </button>
        <div class="overlay-content">
            <div style="text-align: center; margin-bottom: 20px; padding: 30px 0;">
                <i class="fas fa-brain" style="font-size: 4rem; color: #d946ef; margin-bottom: 20px; text-shadow: 0 0 30px rgba(217, 70, 239, 0.4);"></i>
                <h2 style="margin: 0;">SA EDU AI</h2>
                <p style="color: #888;">ุญุฏุฏ ุงูุชูุงุตูู ูุณุฃููู ุจุจูุงุก ุงูุงุฎุชุจุงุฑ ูู</p>
            </div>
            <textarea id="ai-gen-text" class="smart-input" rows="4" placeholder="ุงูุชุจ ุงูููุถูุน ููุง (ูุซุงู: ุงูุญุฑุจ ุงูุนุงูููุฉ ุงูุซุงููุฉุ ููุงููู ูููุชู...)" style="background: #111; border-color: #333;"></textarea>
            <label class="smart-input" style="display: flex; align-items: center; gap: 10px; cursor: pointer; background: #111; border-color: #333;">
                <i class="fas fa-image" style="color: var(--accent-primary);"></i> <span>ุฑูุน ุตูุฑุฉ ูููููุฌ ูุชุญููููุง</span>
                <input type="file" id="ai-gen-img" hidden accept="image/*" onchange="previewAiGenImg(this)">
            </label>
            <div id="ai-gen-preview" class="hidden" style="margin-bottom: 15px; text-align: center;"><img src="" style="height: 100px; border-radius: 12px; border: 1px solid #333;"></div>
            
            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                <div style="flex: 1;">
                    <label style="color:#aaa; font-size:0.8rem; display:block; margin-bottom:5px;">ุนุฏุฏ ุงูุงุฎุชูุงุฑู (MCQ)</label>
                    <input type="number" id="ai-mcq-count" class="smart-input" value="5" style="text-align: center; margin: 0;">
                </div>
                <div style="flex: 1;">
                    <label style="color:#aaa; font-size:0.8rem; display:block; margin-bottom:5px;">ุนุฏุฏ ุงูููุงูู</label>
                    <input type="number" id="ai-essay-count" class="smart-input" value="0" style="text-align: center; margin: 0;">
                </div>
            </div>

            <div style="margin-top: auto;">
                <button onclick="generateAiQuestions()" class="glossy-black-btn">
                    <i class="fas fa-magic"></i> ุชูููุฏ ุงูุงุฎุชุจุงุฑ ุงูุขู
                </button>
            </div>
        </div>
    </div>

    <div id="phone-modal" class="hidden">
        <div class="bottom-sheet-content" style="background: #111; height: auto; text-align:center;">
            <i class="fas fa-mobile-alt" style="font-size: 3rem; color: var(--accent-primary); margin-bottom: 15px;"></i>
            <h3>ูุทููุจ ุฑูู ููุชูุงุตู</h3>
            <p style="color:#aaa; font-size:0.9rem; margin-bottom:20px;">ูุฑุฌู ุฅุฏุฎุงู ุฑูู ูุงุชู ููู ุงูุฃูุฑ ุฃู ุฑููู ุงูุดุฎุตู ูุญูุธ ุงููุชุงุฆุฌ.</p>
            <input type="tel" id="student-phone-input" class="smart-input" placeholder="01xxxxxxxxx" style="text-align:center; font-size:1.1rem; letter-spacing:2px;">
            <button onclick="savePhoneAndStart()" class="modern-btn" style="margin-top:15px;">ุญูุธ ูุจุฏุก ุงูุงุฎุชุจุงุฑ</button>
        </div>
    </div>

    <div id="teacher-detail-modal" class="hidden">
        <div class="bottom-sheet-content" style="background: #111; max-height: 90vh;">
             <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                 <h3 style="margin:0;">ุชูุงุตูู ุงูุทุงูุจ</h3>
                 <button onclick="document.getElementById('teacher-detail-modal').classList.add('hidden')" style="background:none; border:none; color:#fff;"><i class="fas fa-times fa-lg"></i></button>
             </div>
             <div style="text-align:center; background:rgba(255,255,255,0.05); padding:15px; border-radius:15px; margin-bottom:20px;">
                 <div id="td-name" style="font-weight:bold; font-size:1.2rem;"></div>
                 <div id="td-phone" style="color:var(--accent-gold); font-size:1.1rem; margin-top:5px; font-family:monospace;"></div>
             </div>
             <h4 style="color:#888;">ุณุฌู ุงูุฅุฌุงุจุงุช:</h4>
             <div id="td-answers-list" style="max-height: 50vh; overflow-y:auto;"></div>
        </div>
    </div>

    <div id="xp-reward-modal" class="hidden">
        <div class="bottom-sheet-content" style="background:#111; text-align:center;">
            <i class="fas fa-gift" id="xp-reward-icon" style="font-size:4rem; color:var(--accent-gold); display:block; margin-bottom:15px;"></i>
            <h2 id="xp-reward-title" style="color:var(--accent-gold);">๐ ุตูุฏูู ููุงูุขุช!</h2>
            <p id="xp-reward-msg" style="color:#aaa; font-size:1rem; margin-bottom:20px;"></p>
            <button onclick="document.getElementById('xp-reward-modal').classList.add('hidden')" class="modern-btn">ุฑุงุฆุน! <i class="fas fa-thumbs-up"></i></button>
        </div>
    </div>

    <div id="leaderboard-modal" class="hidden">
        <div class="bottom-sheet-content" style="background:#111; max-height:85vh;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h3 style="margin:0;"><i class="fas fa-trophy" style="color:var(--accent-gold);"></i> ููุญุฉ ุงููุชุตุฏุฑูู</h3>
                <button onclick="document.getElementById('leaderboard-modal').classList.add('hidden')" style="background:none; border:none; color:#fff;"><i class="fas fa-times fa-lg"></i></button>
            </div>
            <div id="leaderboard-list"></div>
        </div>
    </div>

    <div id="sa-custom-alert" class="">
        <div class="sa-alert-box">
            <div id="sa-alert-icon" class="sa-alert-icon"></div>
            <div id="sa-alert-title" class="sa-alert-title"></div>
            <div id="sa-alert-msg" class="sa-alert-msg"></div>
            <div id="sa-alert-actions" class="sa-alert-actions"></div>
        </div>
    </div>

    <div id="pwa-install-banner" class="hidden">
        <div class="pwa-content">
            <img src="https://i.postimg.cc/BQQb5YDn/MOWU-DESIGN.png" alt="SA EDU App" class="pwa-icon">
            <div class="pwa-info">
                <h4>ุชุซุจูุช SA EDU</h4>
                <p>ุชุฌุฑุจุฉ ุฃูุถู ูุฃุณุฑุน</p>
            </div>
        </div>
        <div class="pwa-actions">
            <button class="pwa-btn close" onclick="closePWA()">ุฅุบูุงู</button>
            <button class="pwa-btn install" onclick="installPWA()">ุชุซุจูุช</button>
        </div>
    </div>

    <div id="sa-toast-container"></div>

    <div id="tab-dots" class="tab-dots hidden"></div>

    <!-- ============ DIRECT VOICE CALL OVERLAY ============ -->
    <div id="direct-call-overlay">
        <div class="call-avatar-ring" id="call-overlay-avatar">
            <i class="fas fa-user-graduate"></i>
        </div>
        <div class="call-name-text" id="call-overlay-name">...</div>
        <div class="call-status-text" id="call-overlay-status">ููุงููุฉ ูุงุฑุฏุฉ...</div>
        <div class="call-duration-timer" id="call-duration-timer">0:00</div>
        <div class="call-mute-row" id="call-mute-row" style="display:none">
            <button class="call-mute-btn" id="call-mute-btn" onclick="toggleCallMute()">
                <i class="ph-bold ph-microphone"></i>
            </button>
            <button class="call-mute-btn" id="call-speaker-btn" onclick="toggleCallSpeaker()">
                <i class="ph-bold ph-speaker-high"></i>
            </button>
        </div>
        <div class="call-actions">
            <button class="call-action-btn accept" id="call-accept-btn" onclick="acceptDirectCall()">
                <i class="ph-bold ph-phone"></i>
            </button>
            <button class="call-action-btn reject" onclick="rejectOrEndDirectCall()">
                <i class="ph-bold ph-phone-disconnect"></i>
            </button>
        </div>
    </div>

    <!-- ============ INCOMING CALL TOAST ============ -->
    <div class="call-toast" id="call-toast-banner">
        <div class="call-toast-avatar" id="call-toast-avatar"><i class="fas fa-user"></i></div>
        <div class="call-toast-info">
            <div class="call-toast-name" id="call-toast-name">...</div>
            <div class="call-toast-sub">ููุงููุฉ ุตูุชูุฉ ูุงุฑุฏุฉ...</div>
        </div>
        <div class="call-toast-btns">
            <button class="call-toast-btn rej" onclick="rejectOrEndDirectCall()"><i class="ph-bold ph-phone-disconnect"></i></button>
            <button class="call-toast-btn ans" onclick="acceptDirectCall()"><i class="ph-bold ph-phone"></i></button>
        </div>
    </div>

    <!-- Remote audio for direct calls -->
    <audio id="direct-call-remote-audio" autoplay></audio>
    <!-- ============ END DIRECT VOICE CALL ============ -->

    <script>
    function toggleAiSendMic(role, value) {
        const micBtn = document.getElementById(role + '-mic-btn');
        const sendBtn = document.getElementById(role + '-send-btn');
        if (!micBtn || !sendBtn) return;
        if (value && value.trim()) {
            micBtn.style.display = 'none';
            sendBtn.style.display = 'flex';
        } else {
            micBtn.style.display = 'flex';
            sendBtn.style.display = 'none';
        }
    }

    let mediaRecorder = null;
    let isRecording = false;

    function startVoiceInput(role) {
        const micBtn = document.getElementById(role + '-mic-btn');
        const input = document.getElementById(role + '-ai-input');
        
        if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
            if (typeof saAlert === 'function') {
                saAlert('โ', 'ุบูุฑ ูุฏุนูู', 'ุงููุชุตูุญ ูุง ูุฏุนู ุงูุฅุฏุฎุงู ุงูุตูุชู. ุฌุฑุจ Chrome ุฃู Edge.');
            } else {
                alert('ุงููุชุตูุญ ูุง ูุฏุนู ุงูุฅุฏุฎุงู ุงูุตูุชู. ุฌุฑุจ Chrome.');
            }
            return;
        }

        if (isRecording) {
            if (window._speechRecog) window._speechRecog.stop();
            return;
        }

        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recog = new SpeechRecognition();
        window._speechRecog = recog;
        recog.lang = 'ar-SA';
        recog.continuous = false;
        recog.interimResults = false;

        recog.onstart = () => {
            isRecording = true;
            if (micBtn) micBtn.classList.add('recording');
        };

        recog.onresult = (e) => {
            const text = e.results[0][0].transcript;
            if (input) {
                input.value = (input.value + ' ' + text).trim();
                toggleAiSendMic(role, input.value);
            }
        };

        recog.onerror = () => {
            isRecording = false;
            if (micBtn) micBtn.classList.remove('recording');
        };

        recog.onend = () => {
            isRecording = false;
            if (micBtn) micBtn.classList.remove('recording');
        };

        recog.start();
    }
    </script>

    <!-- ============ VOICE ROOMS SYSTEM ============ -->
    <div id="voice-audio-container" style="display:none;"></div>

    <!-- Voice Rooms List Panel -->
    <div class="vr-panel-backdrop" onclick="closeVoiceRooms()"></div>
    <div id="voice-rooms-panel" class="vr-panel">
        <div class="vr-panel-handle"></div>
        <div class="vr-panel-header">
            <div>
                <div class="vr-panel-title"><i class="ph-bold ph-microphone"></i> ุบุฑู ุงูุตูุช</div>
                <div class="vr-panel-sub">ุชุญุฏุซ ูุน ุงูุฌููุน ูุจุงุดุฑุฉ</div>
            </div>
            <button class="icon-btn-small" onclick="closeVoiceRooms()"><i class="ph-bold ph-x"></i></button>
        </div>

        <div class="vr-create-box">
            <input type="text" id="voice-room-name-input" class="vr-name-input" placeholder="ุงุณู ุงูุบุฑูุฉ (ุงุฎุชูุงุฑู)..." maxlength="30">
            <button class="vr-create-btn" onclick="voiceCreateRoom()">
                <i class="ph-bold ph-plus-circle"></i> ุฅูุดุงุก ุบุฑูุฉ ุฌุฏูุฏุฉ
            </button>
        </div>

        <div class="vr-divider"><span>ุงูุบุฑู ุงูููุชูุญุฉ</span></div>

        <div id="voice-rooms-list" class="vr-rooms-list">
            <div class="vr-loading"><div class="vr-spin"></div></div>
        </div>
    </div>

    <!-- Audio Permission Gate -->
    <div id="voice-audio-gate" class="vr-gate">
        <div class="vr-gate-card">
            <button class="vr-gate-close" onclick="closeVoiceGate()"><i class="ph-bold ph-x"></i></button>
            <div class="vr-gate-icon">
                <i class="ph-bold ph-microphone"></i>
                <div class="vr-gate-ripple"></div>
                <div class="vr-gate-ripple" style="animation-delay:0.4s"></div>
            </div>
            <div class="vr-gate-title">ุงููุตูู ูููุงููุฑูููู</div>
            <div class="vr-gate-desc">SA EDU ุชุญุชุงุฌ ุฅุฐู ูููุงููุฑูููู ูุชูุนูู ุงูููุงููุฉ ุงูุตูุชูุฉ ุงูุฌูุงุนูุฉ</div>
            <button id="voice-gate-btn" class="vr-gate-btn" onclick="voiceConfirmEntry()">
                <i class="ph-bold ph-microphone"></i> ุฏุฎูู ุงูุบุฑูุฉ
            </button>
        </div>
    </div>

    <!-- Active Voice Room Full Screen -->
    <div id="voice-room-screen" class="vr-room-screen">
        <div class="vr-room-bg"></div>

        <div class="vr-room-topbar">
            <div class="vr-live-badge"><span class="vr-pulse"></span> ูุจุงุดุฑ</div>
            <div>
                <div id="vroom-name" class="vr-room-title">ุบุฑูุฉ ุตูุชูุฉ</div>
                <div id="vroom-count" class="vr-room-count">0 ูุดุงุฑู</div>
            </div>
            <button class="vr-topbar-btn" onclick="voiceShareRoom()" title="ูุดุงุฑูุฉ">
                <i class="ph-bold ph-share-network"></i>
            </button>
        </div>

        <div id="voice-users-grid" class="vr-users-grid"></div>

        <!-- Filters popup -->
        <div id="vr-filter-menu" class="vr-filter-menu">
            <div class="vr-filter-opt active" onclick="voiceApplyFilter('none', this)"><i class="ph-bold ph-wave-sawtooth"></i><span>ุนุงุฏู</span></div>
            <div class="vr-filter-opt" onclick="voiceApplyFilter('deep', this)"><i class="ph-bold ph-equalizer"></i><span>ุนููู</span></div>
            <div class="vr-filter-opt" onclick="voiceApplyFilter('echo', this)"><i class="ph-bold ph-arrows-clockwise"></i><span>ุตุฏู</span></div>
            <div class="vr-filter-opt" onclick="voiceApplyFilter('robot', this)"><i class="ph-bold ph-robot"></i><span>ุฑูุจูุช</span></div>
        </div>

        <!-- Dock -->
        <div class="vr-dock-wrap">
            <div class="vr-dock">
                <button id="vr-mic-btn" class="vr-dock-btn active" onclick="voiceToggleMic()" title="ูุชู/ุชุดุบูู">
                    <i class="ph-bold ph-microphone"></i>
                </button>
                <button class="vr-dock-btn" onclick="voiceToggleFilters()" title="ููุงุชุฑ ุงูุตูุช">
                    <i class="ph-bold ph-sliders-horizontal"></i>
                </button>
                <button class="vr-dock-btn danger" onclick="voiceExitRoom()" title="ูุบุงุฏุฑุฉ">
                    <i class="ph-bold ph-phone-disconnect"></i>
                </button>
            </div>
        </div>
    </div>
    <!-- ============ END VOICE ROOMS ============ -->

    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script type="module" src="script.js"></script>
</body>
</html>
